% Generated by Sphinx.
\def\sphinxdocclass{report}
\newif\ifsphinxKeepOldNames \sphinxKeepOldNamestrue
\documentclass[letterpaper,10pt,english]{sphinxmanual}
\usepackage{iftex}

\ifPDFTeX
  \usepackage[utf8]{inputenc}
\fi
\ifdefined\DeclareUnicodeCharacter
  \DeclareUnicodeCharacter{00A0}{\nobreakspace}
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage{babel}
\usepackage{times}
\usepackage[Sonny]{fncychap}
\usepackage{longtable}
\usepackage{sphinx}
\usepackage{multirow}
\usepackage{eqparbox}

\addto\captionsenglish{\renewcommand{\contentsname}{Conceptos iniciales}}

\addto\captionsenglish{\renewcommand{\figurename}{Fig.\@ }}
\addto\captionsenglish{\renewcommand{\tablename}{Table }}
\SetupFloatingEnvironment{literal-block}{name=Listing }

\addto\extrasenglish{\def\pageautorefname{page}}

\setcounter{tocdepth}{1}


\title{IvozProvider 1.0 Documentation}
\date{Oct 28, 2016}
\release{Oasis}
\author{Irontec}
\newcommand{\sphinxlogo}{}
\renewcommand{\releasename}{Release}
\makeindex

\makeatletter
\def\PYG@reset{\let\PYG@it=\relax \let\PYG@bf=\relax%
    \let\PYG@ul=\relax \let\PYG@tc=\relax%
    \let\PYG@bc=\relax \let\PYG@ff=\relax}
\def\PYG@tok#1{\csname PYG@tok@#1\endcsname}
\def\PYG@toks#1+{\ifx\relax#1\empty\else%
    \PYG@tok{#1}\expandafter\PYG@toks\fi}
\def\PYG@do#1{\PYG@bc{\PYG@tc{\PYG@ul{%
    \PYG@it{\PYG@bf{\PYG@ff{#1}}}}}}}
\def\PYG#1#2{\PYG@reset\PYG@toks#1+\relax+\PYG@do{#2}}

\expandafter\def\csname PYG@tok@gd\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PYG@tok@gu\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PYG@tok@gt\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PYG@tok@gs\endcsname{\let\PYG@bf=\textbf}
\expandafter\def\csname PYG@tok@gr\endcsname{\def\PYG@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PYG@tok@cm\endcsname{\let\PYG@it=\textit\def\PYG@tc##1{\textcolor[rgb]{0.25,0.50,0.56}{##1}}}
\expandafter\def\csname PYG@tok@vg\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.73,0.38,0.84}{##1}}}
\expandafter\def\csname PYG@tok@m\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@mh\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@cs\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.50,0.56}{##1}}\def\PYG@bc##1{\setlength{\fboxsep}{0pt}\colorbox[rgb]{1.00,0.94,0.94}{\strut ##1}}}
\expandafter\def\csname PYG@tok@ge\endcsname{\let\PYG@it=\textit}
\expandafter\def\csname PYG@tok@vc\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.73,0.38,0.84}{##1}}}
\expandafter\def\csname PYG@tok@il\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@go\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.20,0.20,0.20}{##1}}}
\expandafter\def\csname PYG@tok@cp\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@gi\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PYG@tok@gh\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PYG@tok@ni\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.84,0.33,0.22}{##1}}}
\expandafter\def\csname PYG@tok@nl\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.13,0.44}{##1}}}
\expandafter\def\csname PYG@tok@nn\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.05,0.52,0.71}{##1}}}
\expandafter\def\csname PYG@tok@no\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.38,0.68,0.84}{##1}}}
\expandafter\def\csname PYG@tok@na\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@nb\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@nc\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.05,0.52,0.71}{##1}}}
\expandafter\def\csname PYG@tok@nd\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.33,0.33,0.33}{##1}}}
\expandafter\def\csname PYG@tok@ne\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@nf\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.02,0.16,0.49}{##1}}}
\expandafter\def\csname PYG@tok@si\endcsname{\let\PYG@it=\textit\def\PYG@tc##1{\textcolor[rgb]{0.44,0.63,0.82}{##1}}}
\expandafter\def\csname PYG@tok@s2\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@vi\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.73,0.38,0.84}{##1}}}
\expandafter\def\csname PYG@tok@nt\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.02,0.16,0.45}{##1}}}
\expandafter\def\csname PYG@tok@nv\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.73,0.38,0.84}{##1}}}
\expandafter\def\csname PYG@tok@s1\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@gp\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.78,0.36,0.04}{##1}}}
\expandafter\def\csname PYG@tok@sh\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@ow\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@sx\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.78,0.36,0.04}{##1}}}
\expandafter\def\csname PYG@tok@bp\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@c1\endcsname{\let\PYG@it=\textit\def\PYG@tc##1{\textcolor[rgb]{0.25,0.50,0.56}{##1}}}
\expandafter\def\csname PYG@tok@kc\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@c\endcsname{\let\PYG@it=\textit\def\PYG@tc##1{\textcolor[rgb]{0.25,0.50,0.56}{##1}}}
\expandafter\def\csname PYG@tok@mf\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@err\endcsname{\def\PYG@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PYG@tok@mb\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@ss\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.32,0.47,0.09}{##1}}}
\expandafter\def\csname PYG@tok@sr\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.14,0.33,0.53}{##1}}}
\expandafter\def\csname PYG@tok@mo\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@kd\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@mi\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.13,0.50,0.31}{##1}}}
\expandafter\def\csname PYG@tok@kn\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@o\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PYG@tok@kr\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@s\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@kp\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@w\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PYG@tok@kt\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.56,0.13,0.00}{##1}}}
\expandafter\def\csname PYG@tok@sc\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@sb\endcsname{\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@k\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.00,0.44,0.13}{##1}}}
\expandafter\def\csname PYG@tok@se\endcsname{\let\PYG@bf=\textbf\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}
\expandafter\def\csname PYG@tok@sd\endcsname{\let\PYG@it=\textit\def\PYG@tc##1{\textcolor[rgb]{0.25,0.44,0.63}{##1}}}

\def\PYGZbs{\char`\\}
\def\PYGZus{\char`\_}
\def\PYGZob{\char`\{}
\def\PYGZcb{\char`\}}
\def\PYGZca{\char`\^}
\def\PYGZam{\char`\&}
\def\PYGZlt{\char`\<}
\def\PYGZgt{\char`\>}
\def\PYGZsh{\char`\#}
\def\PYGZpc{\char`\%}
\def\PYGZdl{\char`\$}
\def\PYGZhy{\char`\-}
\def\PYGZsq{\char`\'}
\def\PYGZdq{\char`\"}
\def\PYGZti{\char`\~}
% for compatibility with earlier versions
\def\PYGZat{@}
\def\PYGZlb{[}
\def\PYGZrb{]}
\makeatother

\renewcommand\PYGZsq{\textquotesingle}

\begin{document}

\maketitle
\tableofcontents
\phantomsection\label{index::doc}
\begin{notice}{danger}{Danger:}
Work in progress:
\begin{itemize}
\item {} 
\textbf{{[}P{]}}: Pending (not even started)

\item {} 
\textbf{{[}S{]}}: Started (but not finished)

\end{itemize}

Not marked sections are finished.
\end{notice}




\chapter{Introduction to IvozProvider}
\label{intro/index:documentacion-oficial-de-ivozprovider}\label{intro/index::doc}\label{intro/index:introduccion-a-ivozprovider}
The following sections will serve as general introduction to IvozProvider:


\section{About this document}
\label{intro/about:sobre-este-documento}\label{intro/about::doc}
This document describes the process of installation and usage of IvozProvider, the multi-tenant telephony platform for providers developed by \href{http://irontec.com}{Irontec}.

This should be the starting point for anyone interested in this solution, both  from the technical point of view and the user one and it's divided in four blocks:
\begin{itemize}
\item {} 
The first block is about {\hyperref[index:concepts]{\sphinxcrossref{\DUrole{std,std-ref}{Conceptos iniciales}}}} where each element of the product and its main function is decscribed.

\item {} 
The second block describes the {\hyperref[index:installation]{\sphinxcrossref{\DUrole{std,std-ref}{Instalación y configuración mínima}}}} process with a fresh installed platform, leaving the deep configuration details for the next block.

\item {} 
The third block goes deeper into the most {\hyperref[index:advanced]{\sphinxcrossref{\DUrole{std,std-ref}{Configuración avanzada}}}} features like \textbf{trarification, billing, PBX advanced options and every call details} that were omitted in the previous block.

\item {} 
The fourth and last block describes the {\hyperref[index:security]{\sphinxcrossref{\DUrole{std,std-ref}{Seguridad y mantenimiento}}}} measures that implements the solution.

\end{itemize}


\section{Getting help}
\label{intro/getting_help:getting-help}\label{intro/getting_help::doc}\label{intro/getting_help:obtener-ayuda}
IvozProvider is an alive and highliy developed project. There are multiple channels to get information or report bugs:
\begin{itemize}
\item {} 
GitHub: \url{https://github.com/irontec/ivozprovider}

\item {} 
Users mailing list: \href{mailto:users@lists-ivozprovider.irontec.com}{users@lists-ivozprovider.irontec.com}

\item {} 
Developers mailing list: \href{mailto:dev@lists-ivozprovider.irontec.com}{dev@lists-ivozprovider.irontec.com}

\item {} 
email: \href{mailto:vozip@irontec.com}{vozip@irontec.com}

\item {} 
Twitter: \href{https://twitter.com/irontec}{@irontec}

\item {} 
IRC Channel \href{https://webchat.freenode.net/?channels=ivozprovider}{\#ivozprovider}

\end{itemize}

Don't hesitate to contact us for any kind of feedback :)


\section{What is IvozProvider?}
\label{intro/what_is_ivozprovider::doc}\label{intro/what_is_ivozprovider:que-es-ivozprovider}
IvozProvider is a {\hyperref[intro/what_is_ivozprovider:operator\string-oriented]{\sphinxcrossref{\DUrole{std,std-ref}{provider oriented}}}} {\hyperref[intro/what_is_ivozprovider:multilevel]{\sphinxcrossref{\DUrole{std,std-ref}{multilevel}}}} {\hyperref[intro/what_is_ivozprovider:voip]{\sphinxcrossref{\DUrole{std,std-ref}{IP telephony}}}} solution {\hyperref[intro/what_is_ivozprovider:exposed]{\sphinxcrossref{\DUrole{std,std-ref}{exposed to the public network}}}}.


\subsection{IP Telephony}
\label{intro/what_is_ivozprovider:voip}\label{intro/what_is_ivozprovider:telefonia-ip}
IvozProvider supports telephony systems that use \emph{Session Initialitation Protocol}, \textbf{SIP}, described in \href{https://tools.ietf.org/html/rfc3261}{RFC 3261} and any \href{https://www.packetizer.com/ipmc/sip/standards.html}{related RFCs} independent of manufacturers.

This allows total freedom to choose \emph{softphones}, \emph{hardphones} and the rest of elements that interact with IvozProvider, without any kind of binding with a manufacturer.

Right now, IvozProvider supports the following \textbf{transport protocols} for SIP:
\begin{itemize}
\item {} 
UDP

\item {} 
TCP

\item {} 
TLS

\item {} 
Websockets

\end{itemize}

This last transport protocol described in \href{https://tools.ietf.org/html/rfc7118}{RFC 7118} supports web intregrated softphones, using the \href{https://webrtc.org/}{WebRTC} standard allowing browsers to establish real-time \emph{peer-to-peer} connections.

The \textbf{supported audio codec} list is:
\begin{itemize}
\item {} 
PCMA (\emph{alaw})

\item {} 
PCMU (\emph{ulaw})

\item {} 
GSM

\item {} 
SpeeX

\item {} 
G.722

\item {} 
G.726

\item {} 
G.729

\item {} 
iLBC

\item {} 
\href{http://opus-codec.org/}{OPUS}

\end{itemize}


\subsection{Multilevel}
\label{intro/what_is_ivozprovider:multinivel}\label{intro/what_is_ivozprovider:multilevel}
The web portal design of IvozProvider allows \textbf{multiple actors within the same infrastructure}:

\noindent\sphinxincludegraphics{{operator_levels}.png}

In {\hyperref[operation_roles/index:operation\string-roles]{\sphinxcrossref{\DUrole{std,std-ref}{Platform roles}}}} section, the different roles are deeply described, but to sum up:
\begin{itemize}
\item {} 
\textbf{God Admin}: The administrator and maintainer of the solution. Provides access to multiple brand operators.

\item {} 
\textbf{Brand Operator}: Responsible of giving access, tarificate and bill to multiple company operators.

\item {} 
\textbf{Company Operator}: Responsible of its own PBX configuration and to manage the final platform users.

\item {} 
\textbf{Users}: The last link of the chain, has SIP credentials and can access its own portal for custom configurations.

\end{itemize}

\textbf{Each one} of this roles \textbf{has its own portal} that allows them to fullfill their tasks. Each portal can be customized in the following ways:
\begin{itemize}
\item {} 
Themes and \emph{skins} for corporative colours.

\item {} 
Company Logos.

\item {} 
Customized URLs with the Brand or Company domain.

\end{itemize}


\subsection{Provider oriented}
\label{intro/what_is_ivozprovider:operator-oriented}\label{intro/what_is_ivozprovider:orientada-a-operador}
IvozProvider is a telephony solution \textbf{designed with horizontal scaling in mind}, what allows handling a great amount of \textbf{traffic and users} only by increasing the machines and resources of them.

This are the main ideas that makes this product provider oriented:
\begin{itemize}
\item {} 
Despite the fact that all machine profiles can run in the same host, whatmakes it easier for the initial testing, each profile of IvozProvider can be splitted from the rest to make it run in its own machine.

\item {} 
A \textbf{distributed installation} allows to distribute the correct amount of resources to each task, but also:
\begin{itemize}
\item {} 
Geographic distribution of elements to warranty high availability in caseof CPD failure.

\item {} 
Setup of key elements near the final users, to minimize the communication latencies.

\item {} 
Horizontal scaling of key profiles to handle hundred of thousands concurrent calls.

\end{itemize}

\end{itemize}

The resource consuming elements that limit the service of VoIP solutions use to be:
\begin{itemize}
\item {} 
Already established calls audio management.

\item {} 
Managing configuration for each company administrator (IVRs, conference rooms, external call filters, etc.)

\item {} 
Databases of configuration and records.

\end{itemize}

IvozProvider was designed always keeping in mind the \textbf{horizontal scaling} of each of its elements, so it \textbf{can handle hundred of thousands concurrent calls} and what is more important, \textbf{adapt the platform resources to the expected service quality}:
\begin{itemize}
\item {} 
\textbf{Media-relay} servers handle audio frames for the already established calls:
\begin{itemize}
\item {} 
You can use as many media-relays as you need.

\item {} 
You can join media-relay in groups, and force some companies to use a group if you want.

\item {} 
You can setup media-relays near the final users, to minimize network latencies in the calls.

\end{itemize}

\item {} 
\textbf{Application servers} are in charge of processing the configurad logi
\begin{itemize}
\item {} 
They scale horizontally: new Application Serves can be installed and added to the pool if you feel the need.

\item {} 
Every call is handled by the least busy Appliction Server

\item {} 
By default, there is no static assigment* between Companies and Application Servers. This way failure of any Application Server is not critical: the platform will ignore the faulty Application Server while distributing calls.

\end{itemize}

\end{itemize}


\subsection{Exposed to the public network}
\label{intro/what_is_ivozprovider:expuesta-a-la-red-publica}\label{intro/what_is_ivozprovider:exposed}
As showed in the installation proces, \textbf{IvozProvider is designed to serve users directly from Internet}. Althoughit can be used in local enviroments, IvozProvider is designed to use public IP addresses for its services, removing the need of VPN or IPSec tunnels that connect the infrastructure with the final users

Highlights:
\begin{itemize}
\item {} 
Only the required services will be exposed to Internet.

\item {} 
The unstrusted origins access can be filtered out by integrated firewall

\item {} 
Access from IP addresses or networks can be filtered to avoid any kind of Phishing.

\item {} 
There is also an anti-flood mechanism to avoid short-life Denial of Service attacks.

\item {} 
Each company concurrent calls can be limited to a fixed amount.

\item {} 
IvozProvider supports conections from users behind \href{https://en.wikipedia.org/wiki/Network\_address\_translation}{NAT}.

\item {} 
IvozProvider keep track of those NAT windows and keep them alive with \emph{nat-piercing} mechanisms.

\end{itemize}


\section{What is inside IvozProvider?}
\label{intro/what_is_inside:que-hay-dentro-de-ivozprovider}\label{intro/what_is_inside::doc}
IvozProvider uses well-known and stable \href{https://www.gnu.org/philosophy/free-sw.en.html}{Free Software} projects to fullfill the different required task of the platform.

Nothing better than an image to show all the software that its integrated into IvozProvider:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{ivozprovider_logos}.png}\hspace*{\fill}}

\begin{notice}{note}{Note:}
We can not stress enough our gratitude to the developers and communities of this projects.
\end{notice}

The task of each of this software will be deeply detailed in the block {\hyperref[architecture/index:architecture]{\sphinxcrossref{\DUrole{std,std-ref}{{[}P{]} Platform general architecture}}}}.


\section{Who should use IvozProvider?}
\label{intro/use_cases::doc}\label{intro/use_cases:quien-deberia-de-usar-ivozprovider}
IvozProvider is a good option for those insterested in having a telephony platform that can provide service to \textbf{hundred of thousands concurrent calls}.

The greatest strengths of IvozProvide can help to decide if the solution feeds your needs:
\begin{itemize}
\item {} 
VoIP: SIP

\item {} 
Multilevel, multitenant

\item {} 
Horizontal scaling

\item {} 
PseudoSBC: open to Internet

\item {} 
PBX Features

\end{itemize}

The installation process is so simple, that the best way to test if IvozProvider fullfills yout needs is to test it!


\chapter{{[}P{]} Platform general architecture}
\label{architecture/index:p-arquitectura-general-de-la-plataforma}\label{architecture/index::doc}\label{architecture/index:architecture}

\section{General diagram}
\label{architecture/index:esquema-general}
Following diagram shows the global architecture of IvozProvider solution, with all its components:

\noindent\sphinxincludegraphics{{ivozprovider_flows}.png}

This is a more conceptual diagram:

\noindent\sphinxincludegraphics{{ivozprovider_esquema_conceptual}.png}


\section{SIP signaling flow}
\label{architecture/index:flujo-senalizacion-sip}\label{architecture/index:signallingflow}

\section{RTP audio flow}
\label{architecture/index:flujo-audio-rtp}\label{architecture/index:audioflow}

\section{HTTPS traffic}
\label{architecture/index:trafico-https}

\section{Additional elements}
\label{architecture/index:elementos-adicionales}

\section{Auxiliar elements}
\label{architecture/index:elementos-auxiliares}

\chapter{Platform roles}
\label{operation_roles/index:operation-roles}\label{operation_roles/index:roles-de-la-plataforma}\label{operation_roles/index::doc}
IvozProvider is a multilevel role provider solution.

The following images shows the different available levels and the relation between them:

\noindent\sphinxincludegraphics{{operator_levels1}.png}

This section will explain each of the available roles, describing their responsibilities and more important tasks.


\section{Global administator role}
\label{operation_roles/index:rol-de-administrador-global}
The global administator role (operator in the image) is usually done by the installation responsible.

All options and platform features are visible to this role and usually is in charge of its maintenance.

Their most important task is to \textbf{create Brands} and configure them so they have the enough autonomy to properly use the platform:
\begin{itemize}
\item {} 
Configure their web access.

\item {} 
Configure their brand portal look and feel: themes, colors, etc.

\end{itemize}

Appart from their main task, their global visibility and total access makes them responsible of:
\begin{itemize}
\item {} 
Monitor the platform so it keeps always UP \& RUNNING

\item {} 
Analyze platform logs to track possible errors.

\item {} 
Polish the security mechanisms to avoid external attacks.

\item {} 
Obtain global statistics of calls audio quality.

\item {} 
Increase the available resources of the platform as long as is needed:
\begin{itemize}
\item {} 
Increasing resources available in a standalone installation

\item {} 
Migrating, whenever required, to a distributed installation with multiple AS, media relays, etc.

\end{itemize}

\end{itemize}

To sum up, \textbf{this role is the only one that has no limits within the platform}, thats why \emph{God} is a term used in multiple places along this documentation.

\begin{notice}{important}{Important:}
\emph{This role is responsible of maintain the platform*}, configuring it for the correct behaviour. This role \textbf{doesn't have any kind of limit} and \textbf{grants access} to the \textbf{brand operators}.
\end{notice}


\section{Brand andministator role}
\label{operation_roles/index:rol-de-operador-de-marca}
Brand operator can access a portal with less sections available compared to the previous role. The general (God) administrator is in charge of providing an URL with credentials for its brand portal.

The most important task for brand operator can be managed through this portal: \textbf{create and configure companies so they can work properly}.

Due to brand operators are also resposible of billing their companies and make sure the external cals are properly setup, it must also manage:
\begin{itemize}
\item {} 
Peering contracts with other IP providers for PSTN interconectivity.

\item {} 
Include all required company information for the billing process.

\item {} 
Pricing plans that will offer to their companies, that will determine how match they pay for each call.

\item {} 
Setup the routes for each outgoing call types based on their final destination

\item {} 
Create the invoices for each billing period and send them to their clients.

\end{itemize}

As you can see, the task of brand operator has little in common with the global operator, but their importance is vital so the final users can use all the features includes in IvozProvider
\phantomsection\label{operation_roles/index:brand-responsibilities}
\begin{notice}{important}{Important:}
\textbf{To sum up}, the brand operators \textbf{grant access} to the \textbf{company} administrators they serve and \textbf{configure the platform to route, tarificate and bill their calls}.
\end{notice}


\section{Company administator role}
\label{operation_roles/index:rol-de-administrador-de-empresa}
The company administrator has access to the portal supplied by the brand operator.

From its point of view, it has a virtual pbx in the cloud that must configure for its users.

To accomplish that, its required:
\begin{itemize}
\item {} 
Configure terminals, extensions and users.

\item {} 
Configure the DDI incoming process with the proper logic:
\begin{itemize}
\item {} 
Directly to an user.

\item {} 
IVRs.

\item {} 
Hunt groups.

\item {} 
Faxes.

\end{itemize}

\item {} 
Give access to the final users to their web portal, so they can configure their profile options:
\begin{itemize}
\item {} 
Call forward

\item {} 
Do not disturb

\item {} 
Call waiting

\end{itemize}

\end{itemize}

\begin{notice}{important}{Important:}
To sum up, the company administrators are resposible for \textbf{configuring the telephony system and make use of all the features available in IvozProvider}.
\end{notice}


\section{Final user role}
\label{operation_roles/index:rol-de-usuario-final}
The final user has two different kinds of credentials, both supplied by its company administator:
\begin{itemize}
\item {} 
User portal access credetentials

\item {} 
SIP credentials used to register its terminal (or terminals) to IvozProvider.

\end{itemize}

Through the user portal, it can browse their call registry and configure:
\begin{itemize}
\item {} 
Call forward

\item {} 
Do not disturb

\item {} 
Call waiting

\end{itemize}

On the other hand, the SIP creadentials allow the users to configure their terminal (or terminals) to place and receive calls.

\begin{notice}{note}{Note:}
The same SIP credentials can be used in multiple devices at the same time,generating what is known as \emph{parallel-forking}: whenever a call is placed to an user, all the active devices will ring so the user can answer the call from any of them.
\end{notice}

\begin{notice}{important}{Important:}
Final users are the ones that use and enjoy all the feature of IvozProvider
\end{notice}


\chapter{{[}S{]} Instalación inicial}
\label{installation/index:s-instalacion-inicial}\label{installation/index::doc}

\section{Tipos de instalación}
\label{installation/install_types::doc}\label{installation/install_types:tipos-de-instalacion}

\subsection{Instalación standalone}
\label{installation/install_types:instalacion-standalone}\label{installation/install_types:id1}

\subsection{Instalación distribuida}
\label{installation/install_types:instalacion-distribuida}\label{installation/install_types:id2}

\section{Requisitos mínimos}
\label{installation/requirements:requisitos-minimos}\label{installation/requirements::doc}

\subsection{Requerimientos del sistema}
\label{installation/requirements:requerimientos-del-sistema}

\subsection{Configuración de red}
\label{installation/requirements:configuracion-de-red}

\subsection{Configuración DNS}
\label{installation/requirements:configuracion-dns}

\section{Instalación por paquetes Debian}
\label{installation/debian_install::doc}\label{installation/debian_install:instalacion-por-paquetes-debian}
IvozProvider está diseñado para instalarse y actualizarse mediante paquetes Debian. En concreto, la release actual esta pensada para funcionar sobre \href{https://www.debian.org/releases/jessie}{Debian Jessie 8}.

Se recomienda emplear las \href{https://www.debian.org/releases/jessie/installmanual}{guias oficiales de instalación} para obtener un sistema base mínimo, ya que toda dependencia que necesite posteriormente será instalada automaticamente.

Tanto si deseas realizar una {\hyperref[installation/install_types:instalacion\string-standalone]{\sphinxcrossref{\DUrole{std,std-ref}{Instalación standalone}}}} o una {\hyperref[installation/install_types:instalacion\string-distribuida]{\sphinxcrossref{\DUrole{std,std-ref}{Instalación distribuida}}}}, es preciso configurar los repositorios de paquetes debian de Irontec.


\subsection{Configurar repositorios APT}
\label{installation/debian_install:configurar-repositorios-apt}
Actualmente se emplean dos repositorios diferentes tanto para la última release de IvozProvider (oasis) como para la de Klear (chloe)

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{g+go}{cd /etc/apt/sources.list.d}
\PYG{g+go}{echo deb http://packages.irontec.com/debian oasis main extra \PYGZgt{} ivozprovider.list}
\PYG{g+go}{echo deb http://packages.irontec.com/debian chloe main \PYGZgt{} klear.list}
\end{Verbatim}

Añadimos la clave publica del repositorio:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{g+go}{wget http://packages.irontec.com/public.key \PYGZhy{}q \PYGZhy{}O \PYGZhy{} \textbar{} apt\PYGZhy{}key add \PYGZhy{}}
\end{Verbatim}


\subsection{Instalar el paquete del rol}
\label{installation/debian_install:instalar-el-paquete-del-rol}
Una vez configurados los repositorios será preciso seleccionar el paquete acorde al perfil que queramos instalar:
\begin{itemize}
\item {} \begin{description}
\item[{Para una {\hyperref[installation/install_types:instalacion\string-standalone]{\sphinxcrossref{\DUrole{std,std-ref}{Instalación standalone}}}}:}] \leavevmode\begin{itemize}
\item {} 
ivozprovider

\end{itemize}

\end{description}

\item {} \begin{description}
\item[{Para una {\hyperref[installation/install_types:instalacion\string-distribuida]{\sphinxcrossref{\DUrole{std,std-ref}{Instalación distribuida}}}}: uno de los paquetes en función rol se desee que desempeñe la máquina}] \leavevmode\begin{itemize}
\item {} 
ivozprovider-profile-data

\item {} 
ivozprovider-profile-proxy

\item {} 
ivozprovider-profile-portal

\item {} 
ivozprovider-profile-as

\end{itemize}

\end{description}

\end{itemize}

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{g+go}{apt\PYGZhy{}get update}
\PYG{g+go}{apt\PYGZhy{}get install ivozprovider}
\end{Verbatim}


\subsection{Completar instalación}
\label{installation/debian_install:completar-instalacion}
Las instalaciones distribuidas requieren multiples configuraciones en funcion del rol que se haya instalado. Consulte \href{http://google.com}{completar la instalción de un rol} para más información.

Las instalaciones standalone cuentan con un menú que ayuda a configurar los datos básicos de los servicios empleados en IvozProvider. Puesto que todos los servicios se ejecutan en la misma máquina, muchos de los procesos vienen configurados automáticamente con los valores por defecto.

El menú permite, entre otros:
\begin{itemize}
\item {} 
Configurar las IPs públicas de los proxies SIP

\item {} 
El lenguaje por defecto que empleará la plataforma

\item {} 
Las contraseñas para acceder a las bases de datos

\end{itemize}

Es posible cambiar cualquiera de estos valores una vez instalado IvozProvider volviendo a ejecutar:

\begin{Verbatim}[commandchars=\\\{\}]
\PYG{g+go}{dpkg\PYGZhy{}reconfigure ivozprovider}
\end{Verbatim}


\section{Instalación desde DockerHub}
\label{installation/docker_install:instalacion-desde-dockerhub}\label{installation/docker_install::doc}

\chapter{Making internal calls}
\label{internal_calls/index::doc}\label{internal_calls/index:realizar-llamadas-internas}
The goal of this block will be to configure IvozProvider to make internal calls, from a fresh base install described in the previous section.

In order to archieve a call between Alice and Bob, it will be required to do task at the 3 levels described in {\hyperref[operation_roles/index:operation\string-roles]{\sphinxcrossref{\DUrole{std,std-ref}{Platform roles}}}}, and that's why we have divided this block into 3 sections:


\section{`General Configuration' block}
\label{internal_calls/god_portal::doc}\label{internal_calls/god_portal:bloque-gestion-general}
\begin{notice}{important}{Important:}
Any of the 2 IP public addresses configured during the installation can be used to access the web portal. The default credentials are \emph{admin / changeme}.
\end{notice}

In this section we will reference everything relative to the global operator role, avaialble in the block \textbf{General configuration} in the web portal (only visible for God administrator):

\noindent{\hspace*{\fill}\sphinxincludegraphics{{bloque_god}.png}\hspace*{\fill}}


\subsection{Customized configration of the installation}
\label{internal_calls/god_portal:configuracion-personalizada-en-la-instalacion}
During the installation process, it will be requested two IP addresses, in order to start following 2 processes:


\subsubsection{Users Proxy}
\label{internal_calls/god_portal:proxyusers}\label{internal_calls/god_portal:proxy-de-usuarios}
This is the SIP proxy exposed to the world where users' terminals are registered.

The value displayed in the section \textbf{Proxy user} will show the IP address supplied during the installation process.

\noindent\sphinxincludegraphics{{proxyusers}.png}


\subsubsection{Trunks Proxy}
\label{internal_calls/god_portal:proxy-de-salida}
This is the SIP proxy exposed to the world that IP Providers configured bythe brand operator will use.

The value displayed in the section \textbf{Proxy trunk} will show the IP address supplied during the installation process.

\noindent\sphinxincludegraphics{{proxytrunks}.png}

\begin{notice}{note}{Note:}
Only the IP address will be displayed as the port will always be 5060 (5061 for SIP over TLS).
\end{notice}

\begin{notice}{danger}{Danger:}
This 2 values can be edited in the portal, but it always must have the same IP address that the proxy processes are listening to.
\end{notice}


\subsection{Standard global configuratio}
\label{internal_calls/god_portal:configuracion-global-estandar}
The installation procesis includes other global values that are static in every IvozProvider installation (standalone) and can also be checked from the web interface.


\subsubsection{Application Servers}
\label{internal_calls/god_portal:servidores-de-aplicacion}
In the section \textbf{Application Servers} will display the IP addresses where the different Asterisk processes are listening for requests and, as mentioned, they scale horizontally to adapt the platform load.

Contrary to the Proxies, this Application Servers are not expoed to the world, so only one will be required in a standalone installation listening at 127.0.0.1 address.

\noindent\sphinxincludegraphics{{app_servers}.png}

\begin{notice}{note}{Note:}
The listening port will not be displayed in this field, as it always will be 6006 (UDP).
\end{notice}

\begin{notice}{important}{Important:}
As soon as another Application Server is added, it will be used for load balancing. If it doesn't answer to requests, it will be disabled automatically.
\end{notice}


\subsubsection{Media relays}
\label{internal_calls/god_portal:servidores-de-media}
Media-relays only move RTP traffic from an established call and, like Application Servers, they allow horizontal scaling to adapt the load of the platform.

Media-relays are organized in groups in order to assign a single group to a company. Each element of the group have a \textbf{metric} that allows non-equal load balancing withing the same group (p.e. media-relay1 metric 1; media-relay2 metric 2: media-relay2 will handle twice the audio of calls compared to media-relay1).

\begin{notice}{hint}{Hint:}
The assignment of media-relay groups to companies allows them to use static resources, disabling global balancing. The most common use for this kind of assignments is to place \textbf{media-relay groups near the company location} (and geographically far from the rest of the platform) in order to \textbf{reduce latencies} during the conversation.
\end{notice}

For a standlone installation, only one media-replay group will exist:

\noindent\sphinxincludegraphics{{media_relay_groups}.png}

By default, this grup will only have one media-replay:

\noindent\sphinxincludegraphics{{media_relays}.png}

\begin{notice}{note}{Note:}
The address displayed is the address of the control coscket, not the address included in the SDP payload during the session negociation.By default, this lonely media-relay will use the same IP address as the proxy that serve users.
\end{notice}


\subsubsection{SIP Domains}
\label{internal_calls/god_portal:dominios-sip}\label{internal_calls/god_portal:god-sipdomains}
The \textbf{Domain} section will display the SIP domains pointing to the  2 public IP addresses:
\begin{itemize}
\item {} 
Users proxy IP address

\item {} 
Trunks proxy IP address

\end{itemize}

After an initial installation 2 domain will exist, one for each of this 2 IP addresses:

\noindent\sphinxincludegraphics{{domain_list_local}.png}

This domains will be used internally and the integrated DNS server of the solution will resolved to the configured IP addressed.

\begin{notice}{attention}{Attention:}
As show in the section {\hyperref[internal_calls/brand_portal:domain\string-per\string-company]{\sphinxcrossref{\DUrole{std,std-ref}{SIP Domain of the company}}}}, each company will need a DNS pointing to the Users proxy IP address. Once configured, the domain will be displayed in this section so the Global operator can check all the configured domains in one shot.
\end{notice}


\subsection{Emulate Demo brand}
\label{internal_calls/god_portal:emular-la-marca-demo}
After the initial installation, the platform includes an already pre-created brand called DemoBrand, that will be used for the starting goal: to have 2 registerd phones that can call each other

Before going into the next section it is important to understand the concept of \textbf{Emulating brands}:
\begin{itemize}
\item {} 
As global operator, you have access to the \textbf{General configuration} block, that only \emph{God} administator can see.

\item {} 
Apart from this block, both \textbf{Brand configuration} and \textbf{Company configuration} are visible, looking more or less like this:

\end{itemize}

\noindent{\hspace*{\fill}\sphinxincludegraphics{{emular_marca_prev}.png}\hspace*{\fill}}
\begin{itemize}
\item {} 
Special caution with the following button:

\end{itemize}

\noindent{\hspace*{\fill}\sphinxincludegraphics{{emular_marca}.png}\hspace*{\fill}}
\begin{itemize}
\item {} 
Once pressed, a modal dial will be displayed so:

\end{itemize}

\noindent{\hspace*{\fill}\sphinxincludegraphics{{emular_marca2}.png}\hspace*{\fill}}
\begin{itemize}
\item {} 
If we select the brand DemoBrand, the icon will change and displays the brand that is being emulated:

\end{itemize}

\noindent{\hspace*{\fill}\sphinxincludegraphics{{emular_marca3}.png}\hspace*{\fill}}
\begin{itemize}
\item {} 
The upper right corner of the portal will also show the brand that is being emulated:

\end{itemize}

\noindent{\hspace*{\fill}\sphinxincludegraphics{{emular_marca4}.png}\hspace*{\fill}}


\subsubsection{What does this emaulation mean?}
\label{internal_calls/god_portal:que-implica-esta-emulacion}
It means that \textbf{everything displayed in `Brand configuration' block is related only with this brand} and is \textbf{exactly} the same data the brand operator will see accessing through the brand portal.

\begin{notice}{tip}{Tip:}
Ok, maybe not \emph{exactly}. The global administator is able to see some fields in some screens of the \textbf{Brand confugration} block that the brand operator can't. For example, while editing a company, \emph{God} administator will see `Media relay group' and `Application Server' fields, while the brand operator won't''
\end{notice}


\section{`Brand Configuration' block}
\label{internal_calls/brand_portal:bloque-configuracion-de-marca}\label{internal_calls/brand_portal::doc}
To make the default DemoBrand have a company with 2 users that can call each other, we only must configure a couple of things in this block.

In fact, while accessing the \textbf{Company} section, we will see the default company \emph{DemoCompany} that we can use to accomplished our more desired goal :)

\noindent\sphinxincludegraphics{{company_list}.png}

There is only one thing missing in this company, marked as \textbf{EDIT} in the  previous image.


\subsection{SIP Domain of the company}
\label{internal_calls/brand_portal:dominio-sip-de-la-compania}\label{internal_calls/brand_portal:domain-per-company}
As documented in the previous section, it is \textbf{a must} that each company have a public domain pointing to the configured IP address for the {\hyperref[internal_calls/god_portal:proxyusers]{\sphinxcrossref{\DUrole{std,std-ref}{Users Proxy}}}}.

\begin{notice}{note}{Note:}
The DNS registy can be type A (supported by all the hardphones/softphine) or type NAPTR+SRV.
\end{notice}

Once the domain is configured (how to archieve this is out of scope for this document), it will be enough to set the correct parameter in our company:

\noindent\sphinxincludegraphics{{set_domain}.png}

Once the company has been saved, the domain will appear in the previous described {\hyperref[internal_calls/god_portal:god\string-sipdomains]{\sphinxcrossref{\DUrole{std,std-ref}{section}}}}:

\noindent\sphinxincludegraphics{{domain_list}.png}

\begin{notice}{attention}{Attention:}
It it quite important to understand this block, without a correctly configured DNS pointing to Users proxy IP address, we will fail our goal!
\end{notice}

This is a good sign for the domain we have already configured, as long as insted of 10.10.3.10 it will show the public IP address configured in {\hyperref[internal_calls/god_portal:proxyusers]{\sphinxcrossref{\DUrole{std,std-ref}{Users Proxy}}}}.

\noindent\sphinxincludegraphics{{dominio_bien_configurado}.png}

\begin{notice}{danger}{Danger:}
Have we stressed enough that without a properly configured DNS pointing to the Users proxy IP address nothing will work?
\end{notice}


\subsubsection{I have no time for a DNS registry}
\label{internal_calls/brand_portal:dnshack}\label{internal_calls/brand_portal:no-tengo-tiempo-para-crear-registros-dns}
Everything we have said is true: as we create new brands and brands create new companies, each of them will need a DNS registry.

But the first company of the platform is quite special and can take over the IP address of the proxy to use it as a domain:

\noindent\sphinxincludegraphics{{fake_domain}.png}

Although it is not a domain, but being used like it was, it will be displayed in \textbf{Domain} section:

\noindent\sphinxincludegraphics{{fake_domain2}.png}

\begin{notice}{tip}{Tip:}
It's important to understand the this trick is only valid for the first company of the platform ;)
\end{notice}


\subsection{Emulate Demo company}
\label{internal_calls/brand_portal:emular-la-empresa-demo}\label{internal_calls/brand_portal:emulate-company}
The company emulation process is the same as the brand emulation, with the difference that it filters the block `Company Configuration' insted of `Brand Configuration'.

\noindent{\hspace*{\fill}\sphinxincludegraphics{{emulate_company}.png}\hspace*{\fill}}

\noindent{\hspace*{\fill}\sphinxincludegraphics{{emulate_company2}.png}\hspace*{\fill}}

Once the company has been emulated, the top right corner of the portal will show that we are in the right path :)

\noindent{\hspace*{\fill}\sphinxincludegraphics{{emular_empresa}.png}\hspace*{\fill}}


\section{`Company Configration' block}
\label{internal_calls/company_portal:bloque-configuracion-de-empresa}\label{internal_calls/company_portal::doc}
We are close to place our first call in our awesome new Ivozprovider, lacking only six more things in our DemoCompany:
\begin{itemize}
\item {} 
2 terminals

\item {} 
2 extension

\item {} 
2 users

\end{itemize}


\subsection{Terminals}
\label{internal_calls/company_portal:terminales}
Go to the terminals section and... voilà! We have already two terminals created:

\noindent\sphinxincludegraphics{{terminals}.png}


\subsection{Extensions}
\label{internal_calls/company_portal:extensiones}
Continue then to the extensions section to discover that someone have already created 2 extensions for us:

\noindent\sphinxincludegraphics{{extensions}.png}

Nothing to do in this section either, lets go to the last one!


\subsection{Users}
\label{internal_calls/company_portal:usuarios}
As expected, we also have 2 users:

\noindent\sphinxincludegraphics{{users}.png}

At this point and without nothing to configure in this block, we already have everything ready to place a call from Alice to Bob.


\section{Configure SIP terminals}
\label{internal_calls/configure_sipuacs::doc}\label{internal_calls/configure_sipuacs:configurar-terminales-sip}
The only thing we require is to have 2 SIP terminals (hardphone, softphone, Android/IOS APP) and configure them as follows:

\textbf{ALICE}
\begin{itemize}
\item {} 
\textbf{User}: alice

\item {} 
\textbf{Password}: alice

\item {} 
\textbf{Domain}'': users.democompany.com (or the IP address if we are using {\hyperref[internal_calls/brand_portal:dnshack]{\sphinxcrossref{\DUrole{std,std-ref}{the domain trick}}}})

\end{itemize}

\textbf{BOB}
\begin{itemize}
\item {} 
\textbf{User}: bob

\item {} 
\textbf{Password}: bob

\item {} 
\textbf{Domain}'': users.democompany.com (or the IP address if we are using {\hyperref[internal_calls/brand_portal:dnshack]{\sphinxcrossref{\DUrole{std,std-ref}{the domain trick}}}})

\end{itemize}

\begin{notice}{tip}{Tip:}
It's possible that both the user and the domain are requested together, so we have to use \href{mailto:alice@users.democompany.com}{alice@users.democompany.com} and \href{mailto:bob@users.democompany.com}{bob@users.democompany.com} (or the IP address if we are using {\hyperref[internal_calls/brand_portal:dnshack]{\sphinxcrossref{\DUrole{std,std-ref}{the domain trick}}}}).
\end{notice}

After configurint the terminals, Alice should be able to call Bob by only dialing 102 in its terminal.


\chapter{Recibir llamadas externas}
\label{external_incoming_calls/index:recibir-llamadas-externas}\label{external_incoming_calls/index::doc}
El objetivo de este bloque será configurar IvozProvider para recibir llamadas externas.

Para ello, seguiremos los siguientes pasos:


\section{Transformaciones numéricas}
\label{external_incoming_calls/numeric_transformations:transformaciones-numericas}\label{external_incoming_calls/numeric_transformations::doc}\label{external_incoming_calls/numeric_transformations:numeric-transformations}

\subsection{Concepto}
\label{external_incoming_calls/numeric_transformations:concepto}
\textbf{IvozProvider} está diseñado con la intención de \textbf{poder dar servicio en cualquier lugar del planeta}, no solamente en el país originario de la solución.

Un concepto muy importante para conseguir este objetivo es el de las transformaciones númericas, que consisten en la \textbf{adaptación de los distintos sistemas de numeración de los países del mundo} definidos en \href{https://www.itu.int/rec/T-REC-E.164/es}{E.164} \textbf{a un formato neutro}.

La sección que le permite configurar al operador de marca todo lo relativo a \textbf{Transformaciones numéricas} es:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{numeric_transformations_section}.png}\hspace*{\fill}}

En concreto, se distinguen 2 casos:


\subsubsection{Adaptación en entrada}
\label{external_incoming_calls/numeric_transformations:adaptacion-en-entrada}
Cuando una llamada entra a IvozProvider procedente de un operador con el que tenemos un acuerdo de \emph{peering}, hay que adaptar las numeraciones que hacen referencia a:
\begin{itemize}
\item {} 
Origen de la llamada.

\item {} 
Destino de la llamada.

\end{itemize}

En función del país del operador indicará los números internacionales de una forma distinta. En el caso de un operador español, por ejemplo:
\begin{itemize}
\item {} 
Utilizará 00 + 33 + número para una llamada con origen francés.

\item {} 
Puede que muestre las numeraciones internacionales sin el 00.

\item {} 
Es probable que si la llamada procede del mismo país del operador, no se muestre el prefijo del país (911234567 en lugar de 00 + 34 + 911234567)

\end{itemize}

En el caso de un operador de Ucrania, que no utiliza 00 como código internacional:
\begin{itemize}
\item {} 
Utilizará 810 + 33 + número francés para el mismo número.

\item {} 
Puede incluso que aparte del código internacional (00 en la mayoría de países del mundo) un operador concreto anteceda sus números con un prefijo concreto.

\end{itemize}

El objetivo de la adaptación de entrada es que, independientemente de la notación utilizada por el operador, la llamada se acabe en un formato homogéneo y común.
\phantomsection\label{external_incoming_calls/numeric_transformations:e164}
\begin{notice}{important}{Important:}
Este formato común se suele llamar E.164 y muestra los números sin el código internacional y con el prefijo de país: e.g. 34911234567
\end{notice}


\subsubsection{Adaptación en salida}
\label{external_incoming_calls/numeric_transformations:adaptacion-en-salida}
Del mismo modo que el origen y el destino se tiene que adaptar en entrada, habrá que adaptar también las numeraciones en salida en función del operador por el que se vaya a sacar la llamada.

Por ejemplo, para una llamada a un número español:
\begin{itemize}
\item {} 
Operador español: El destino vendrá en E164 (34911234567) y habrá que quitar el prefijo de país: 911234567.

\item {} 
Operador francés: El destino vendrá en E164 (34911234567) y habrá que añadir el código internacional: 0034911234567.

\end{itemize}

\begin{notice}{note}{Note:}
En resumen, consiste en entregar origen y destino en el formato en el que el operador elegido los espera, para que la llamada progrese con normalidad.
\end{notice}

\begin{notice}{tip}{Tip:}
Las transformaciones numéricas utilizan \href{https://es.wikipedia.org/wiki/Expresi\%C3\%B3n\_regular}{expresiones regulares} muy simples para describir los cambios a realizar en las numeraciones. En Internet se pueden encontrar múltiples tutoriales sobre el uso básico de expresiones regulares.
\end{notice}


\subsection{Transformación `Operador Nacional'}
\label{external_incoming_calls/numeric_transformations:transformacion-operador-nacional}
IvozProvider permite crear automáticamente las reglas de transformación típicas de la mayoría de países.

Para crear el set de reglas necesarias para los operadores españoles, basta con:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{numeric_transformations_auto}.png}\hspace*{\fill}}

Las reglas que se han autocreado realizan las modificaciones adecuadas para operadores nacionales que muestren las numeraciones siguiendo estas reglas:
\begin{itemize}
\item {} 
Número español: se muestra sin código internacional y sin el 34.

\item {} 
Número internacional: se precede de 00 y del código del país.

\end{itemize}

Los \emph{sets} de transformaciones numéricas se asignan a \textbf{PeeringContracts}, tal y como veremos en la siguiente sección. Este \emph{set} será el adecuado para la mayoría de operadores españoles.

Analicemos el \emph{set} para entender lo que hace cada regla de transformación:

\noindent\sphinxincludegraphics{{numeric_transformations}.png}

\begin{notice}{attention}{Attention:}
La creación automática genera las 8 reglas habituales en función de los parámetros especificados. Estas reglas se pueden editar después, el proceso de automatización termina una vez creado el set.
\end{notice}


\subsubsection{Adaptación en entrada}
\label{external_incoming_calls/numeric_transformations:id1}
Aparece en azul en la imagen anterior:
\begin{itemize}
\item {} 
Izquierda llamado/destino

\item {} 
Derecha llamante/origen

\end{itemize}

Tanto para el origen como para el destino las reglas que se aplican son las mismas:

\noindent\sphinxincludegraphics{{numeric_transformations2}.png}
\begin{itemize}
\item {} \begin{description}
\item[{Las reglas se evalúan antes o después en función del campo \textbf{métrica} (de menor a mayor).}] \leavevmode\begin{itemize}
\item {} 
Si una regla no \emph{matchea}, se evalúa la siguiente regla.

\item {} 
Si una regla \emph{matchea}, no se evalúan más reglas.

\item {} 
Si ninguna regla \emph{matchea}, no se aplica ningún cambio.

\end{itemize}

\end{description}

\item {} 
El campo \textbf{Buscar} se evalúa contra el campo en cuestión (en el caso de la captura, contra el campo Llamado/Destino de una llamada saliente).
\begin{itemize}
\item {} 
Métrica 1: Que empiece por (\textasciicircum{}) 00 o `+', seguido de un dígito del 1 al 9, seguido de 1 o más dígitos del 0 al 9 hasta el final (\$).

\item {} 
Métrica 2: Que empiece por un dígito del 1 al 9, seguido de 1 o más dígitos del 0 al 9 hasta el final (\$).

\end{itemize}

\item {} 
El campo \textbf{Reemplazar} recoge las capturas del campo buscar (expresadas entre paréntesis, 1 para la primera, 2 para la segunda, etc.) y expresa cómo tiene que quedar el número:
\begin{itemize}
\item {} 
Métrica 1: El campo mostrará solo el segundo elemento capturado (2).

\item {} 
Métrica 1: El campo añadirá 34 al primer elemento capturado (1).

\end{itemize}

\item {} 
Explicación \emph{en modo texto}:
\begin{itemize}
\item {} 
Métrica 1: Quitar código internacional (00 o `+') si lo hay.

\item {} 
Métrica 2: Añadir 34 a los números españoles mostrados sin prefijo de país para que queden en E.164.

\end{itemize}

\end{itemize}


\subsubsection{Adaptación en salida}
\label{external_incoming_calls/numeric_transformations:id2}
\noindent\sphinxincludegraphics{{numeric_transformations3}.png}

Siguiendo la misma lógica, estas 2 reglas realizan los siguientes cambos sobre el destino en llamadas salientes:
\begin{itemize}
\item {} 
Métrica 1: Si empieza con 34 seguido de más dígitos, quitamos 34. Convierte números españoles de E.164 a formato nacional.

\item {} 
Métrica 2: Si no empieza por 34, añadimos 00. Convierte números internacionales de E.164 a formato internacional español.

\end{itemize}

\begin{notice}{attention}{Attention:}
\textbf{En resumen}: las transformaciones numéricas adaptan orígenes y destinos, a E.164 en entrada y a los formatos que los operadores esperan en salida, utilizando reglas con expresiones regulares y métricas agrupadas en \emph{sets} que se asocian a \textbf{PeeringContracts}.
\end{notice}


\section{Configurar Contrato de Peering}
\label{external_incoming_calls/peering_contracts:configurar-contrato-de-peering}\label{external_incoming_calls/peering_contracts::doc}\label{external_incoming_calls/peering_contracts:peering-contracts}
En IvozProvider se entiende por \textbf{Contrato de Peering} el acuerdo entre un \textbf{Operador de Marca} y un Operador VoIP para sacar y recibir llamadas.

IvozProvider permite integrarse con Operadores IP por medio de la sección \textbf{Contratos de Peering} que pasamos a describir:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{peeringcontract_section}.png}\hspace*{\fill}}


\subsection{Datos básicos}
\label{external_incoming_calls/peering_contracts:datos-basicos}
Analicemos los campos de un PeeringContract de ejemplo:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{peeringcontract}.png}\hspace*{\fill}}

Si entramos a editar este Contrato de Peering concreto:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{peeringcontract_edit}.png}\hspace*{\fill}}
\begin{description}
\item[{Nombre\index{Nombre|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/peering_contracts:term-nombre}
Se utilizará para referencia a este Contrato de Peering.

\item[{Descripción\index{Descripción|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/peering_contracts:term-descripcion}
Un campo adicional para escribir algún detalle.

\item[{Transformación numérica\index{Transformación numérica|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/peering_contracts:term-transformacion-numerica}
Transformaciones que se aplicarán al origen y al destino a las numeraciones que entren o salgan por este PeeringContract (ver {\hyperref[external_incoming_calls/numeric_transformations:numeric\string-transformations]{\sphinxcrossref{\DUrole{std,std-ref}{Transformaciones numéricas}}}}).

\item[{Tarificación externa\index{Tarificación externa|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/peering_contracts:term-tarificacion-externa}
Módulo de tarificación externa disponible solo para ciertos operadores. Permite poner precio a la llamada atacando una API externa en lugar de hacerlo con las lógicas de IvozProvider. Consultar a los {\hyperref[intro/getting_help:getting\string-help]{\sphinxcrossref{\DUrole{std,std-ref}{desarrolladores de la solución}}}} en caso de estar interesados.

\end{description}

\begin{notice}{important}{Important:}
Los campos marcados con una estrella roja son obligatorios.
\end{notice}


\subsection{PeerServers}
\label{external_incoming_calls/peering_contracts:peerservers}
El concepto de \textbf{PeerServer} se refiere a los distintos servidores SIP que puede tener un Operador IP para servir su dominio SIP. Para definir los PeerServers del OPERADOR que acabamos de definir, hay que pulsar este botón:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{peerservers}.png}\hspace*{\fill}}

Tal y como indica el 0, no hay ningún PeerServer definido, por lo que añadimos uno:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{peerservers_add}.png}\hspace*{\fill}}
\begin{description}
\item[{Nombre\index{Nombre|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/peering_contracts:term-4}
Se utilizará para referencia a este PeerServer.

\item[{Descripción\index{Descripción|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/peering_contracts:term-5}
Un campo adicional para escribir algún detalle.

\item[{SIP Proxy\index{SIP Proxy|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/peering_contracts:term-sip-proxy}
Dirección IP (o registro DNS) del PeerServer. Si utiliza un puerto distinto a 5060, se puede indicar con `:'.

\item[{Esquema URI\index{Esquema URI|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/peering_contracts:term-esquema-uri}
Los esquemas soportados son sip y sips. Dejar en `sip' en caso de duda.

\item[{Transporte\index{Transporte|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/peering_contracts:term-transporte}
Los protocolos de transporte SIP soportados. En caso de duda, dejar `udp'.

\item[{Outbound Proxy\index{Outbound Proxy|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/peering_contracts:term-outbound-proxy}
Normalmente se deja vacío o se pone la IP del dominio indicado en \textbf{SIP Proxy} (para evitar resolución de dominios y hacer que el mensaje SIP contenga el dominio en lugar de una IP). Funciona como un proxy web: en lugar de enviar los mensajes SIP al destino de \textbf{SIP Proxy}, los envía a la IP:PUERTO de este campo.

\item[{Requiere autenticación\index{Requiere autenticación|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/peering_contracts:term-requiere-autenticacion}
Existen contratos de Peering que nos validarán por IP, otros necesitarán que nos autentiquemos en cada sesión que queramos establecer. En caso de ser del último grupo, este selector nos permite introducir un usuario y una contraseña para responder a esa autenticación.

\item[{Cabecera de origen de llamada\index{Cabecera de origen de llamada|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/peering_contracts:term-cabecera-de-origen-de-llamada}
Algunos operadores recogen el origen del From. Otros utilizan el From para validar la cuenta de cliente y necesitan cabeceras adicionales para recoger el origen. En caso de duda, marcar \textbf{PAI}.

\item[{Transformaciones R-URI previas a las transformaciones numéricas\index{Transformaciones R-URI previas a las transformaciones numéricas|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/peering_contracts:term-transformaciones-r-uri-previas-a-las-transformaciones-numericas}
Permiten realizar cambios estáticos al destino de la llamada antes de aplicar las reglas de transformación numéricas mendionadas en {\hyperref[external_incoming_calls/numeric_transformations:numeric\string-transformations]{\sphinxcrossref{\DUrole{std,std-ref}{Transformaciones numéricas}}}}. Se pueden quitar uno dígitos del comienzo, añadir un prefijo después e, incluso, añadir parámetros a la URI siguiendo el formato indicado. En caso de duda, dejar todo el bloque en blanco.

\item[{Personalización de la cabecera From\index{Personalización de la cabecera From|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/peering_contracts:term-personalizacion-de-la-cabecera-from}
Los operadores que muestren el origen en otras cabeceras (PAI/RPID), es posible que nos soliciten que el From User sea el número de cuenta de cliente y el From Domain (por ejemplo), su dominio SIP. En caso de duda, dejar en blanco.

\end{description}

\begin{notice}{tip}{Tip:}
Existen muchos campos para poder establecer \emph{peering} con operadores de todo tipo, pero lo habitual será poner solo nombre y SIP Proxy (para los operadores que nos validen por IP) o nombre, SIP Proxy y Autenticación.
\end{notice}

\begin{notice}{warning}{Warning:}
En caso de definir múltiples PeerServers para un PeeringContract, IvozProvider hará balanceo y failover utilizando todos. Es decir, a veces hablará a uno y otras veces a otro. En caso de que uno no le conteste, lo intentará con el resto hasta dar con uno que conteste.
\end{notice}


\subsection{Registro SIP}
\label{external_incoming_calls/peering_contracts:registro-sip}
Hay operadores que exigen que tengamos un \href{https://tools.ietf.org/html/rfc3261\#section-10}{Registro SIP} activo para que nos metan las llamadas de nuestras numeraciones. Es más, existen operadores que exigen un registro activo para poder sacar llamadas a través de ellos (???).

\begin{notice}{note}{Note:}
IvozProvider soporta \emph{peerings} de todo tipo, pero recomendamos acordar \emph{peerings de tú a tú}: sin autenticación, sin registro y validados por IP. Esto evita tráfico innecesario (autenticación en cada sesión y registros periódicos) y simplifica la configuración, quedándose casi todo con los valores por defecto.
\end{notice}

Por este motivo IvozProvider permite configurar registros SIP periódicos por medio del siguiente botón:

\noindent\sphinxincludegraphics{{sip_registers}.png}

Si creamos uno nuevo, nos encontramos con la siguiente ventana:

\noindent\sphinxincludegraphics{{sip_registers_add}.png}
\begin{description}
\item[{Nombre de usuario\index{Nombre de usuario|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/peering_contracts:term-nombre-de-usuario}
Número de cuenta de cliente o similar proporcionada por el operador que exige registro SIP.

\item[{Dominio\index{Dominio|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/peering_contracts:term-dominio}
Dominio o IP del servidor de registros. Habitualmente el mismo que sirve de Proxy SIP en el PeerServer.

\item[{DDI\index{DDI|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/peering_contracts:term-ddi}
Se envía en la cabecera Contact y tiene que ser único a nivel de toda la plataforma. En PeeringContracts con un DDI asociado, se recomienda meter ese DDI. En caso de múltiples DDIs asociados, se recomienda meter uno de ellos. En caso de ningún DDI asociado, se recomienda meter un valor único (cualquier valor que te deje guardar).

\item[{Usuario\index{Usuario|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/peering_contracts:term-usuario}
Usuario de autenticación, practicamente siempre es igual al ``Nombre de usuario'' por lo que se recomienda dejar en blanco.

\item[{URI Servidor de registro\index{URI Servidor de registro|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/peering_contracts:term-uri-servidor-de-registro}
Normalmente se puede dejar en blanco ya que se deduce del Dominio introducido. Si no fuera así, poner una dirección IP con `sip:' por delante.

\item[{Realm\index{Realm|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/peering_contracts:term-realm}
Dejar en blanco para aceptar el propuesto por el extremo contrario. Definir solo si de estar familiarizado el mecanismo de autorización de SIP y saber lo que este campo implica.

\item[{Expire\index{Expire|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/peering_contracts:term-expire}
Tiempo que IvozProvider sugerirá como tiempo de expiración del registro.

\end{description}

\begin{notice}{tip}{Tip:}
Al igual que ocurre con los PeerServers, existen múltiples campos. Hay que tener en cuenta, no obstante, que la mayoría de operadores no deberían de exigir registro y, los que lo hagan, habitualmente solo requerirán de usuario, dominio y contraseña.
\end{notice}

Una vez que hemos llegado a un acuerdo con un Operador VoIP y hemos configurado esta relación de \emph{peering}, solo faltan dos tareas:


\section{Dar de alta un DDI externo}
\label{external_incoming_calls/configure_ddi:settingup-ddi}\label{external_incoming_calls/configure_ddi:dar-de-alta-un-ddi-externo}\label{external_incoming_calls/configure_ddi::doc}
El operador de marca, como único responsable de llegar a acuerdos de \emph{peering} con operadores IP, es el responsable de dar de alta los DDIs de cada operador.

Para ello, tiene que acceder a la siguiente sección:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{ddis_company_section}.png}\hspace*{\fill}}

Observar que para poder acceder a esta sección el operador de marca (o \emph{god}) tiene que haber emulado una empresa concreta y acceder desde el bloque \textbf{Configuración de empresa}.

\begin{notice}{attention}{Attention:}
La sección \textbf{Configuración de empresa \textgreater{} DDIs} es distinta cuando accede un administrador de empresa que cuando accede un operador global o de marca. El administrador de empresa no puede crear nuevos DDIs ni borrar los que ya existen, solo puede editar los que el operador de marca haya creado.
\end{notice}

Por otra parte, la sección \textbf{Configuración de marca \textgreater{} DDIs} solo sirve para que el operador de marca pueda ver los DDIs asociados a sus distintas empresas, es un listado en \emph{read-only}.

\noindent{\hspace*{\fill}\sphinxincludegraphics{{ddis_brand_section}.png}\hspace*{\fill}}

Una vez explicados estos conceptos, añadimos un nuevo DDI y rellenamos los campos necesarios:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{ddis_add}.png}\hspace*{\fill}}
\phantomsection\label{external_incoming_calls/configure_ddi:bill-inbound}\begin{description}
\item[{País\index{País|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/configure_ddi:term-pais}
El país de la númeración pública que estamos dando de alta.

\item[{DDI\index{DDI|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/configure_ddi:term-ddi}
El número en cuestión, sin códigos de país.

\item[{Contrato de peering\index{Contrato de peering|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/configure_ddi:term-contrato-de-peering}
El contrato de peering por el que entra la numeración. Esta relación permite aplicar las {\hyperref[external_incoming_calls/numeric_transformations:numeric\string-transformations]{\sphinxcrossref{\DUrole{std,std-ref}{Transformaciones numéricas}}}} adecuadas.

\item[{Filtro de entrada\index{Filtro de entrada|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/configure_ddi:term-filtro-de-entrada}
Permite aplicar lógicas de filtrado en base a horario y calendario, se verán en {\hyperref[pbx_features/external_filters:external\string-filters]{\sphinxcrossref{\DUrole{std,std-ref}{Filtros de entrada externo}}}}. Dejar sin seleccionar para no aplicar filtro alguno.

\item[{Enrutar\index{Enrutar|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/configure_ddi:term-enrutar}
Un DDI puede tener distintos {\hyperref[pbx_features/external_ddis:routing\string-logics]{\sphinxcrossref{\DUrole{std,std-ref}{tratamientos}}}}. Para nuestro objetivo, enrutar al usuario \emph{Alice}.

\item[{Grabar llamadas\index{Grabar llamadas|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/configure_ddi:term-grabar-llamadas}
Dejar desactivado de momento, se explicará en {\hyperref[pbx_features/call_recording:call\string-recordings]{\sphinxcrossref{\DUrole{std,std-ref}{Grabación de llamadas}}}}.

\item[{Tarificar llamadas entrantes\index{Tarificar llamadas entrantes|textbf}}] \leavevmode\phantomsection\label{external_incoming_calls/configure_ddi:term-tarificar-llamadas-entrantes}
Requiere del módulo de tarificación externa y permite tarificar llamadas entrantes a numeraciones especiales. Consultar a los {\hyperref[intro/getting_help:getting\string-help]{\sphinxcrossref{\DUrole{std,std-ref}{desarrolladores de la solución}}}} en caso de estar interesados.

\end{description}


\section{Configurar tratamiento en entrada}
\label{external_incoming_calls/configure_ddi:configurar-tratamiento-en-entrada}
En la sección anterior hemos dado de alta el DDI y lo hemos configurado, pero conviene tener claro que \textbf{en un uso normal, el administrador de marca} simplemente \textbf{daría de alta el DDI y el administrador de empresa}, accediendo a la misma sección, \textbf{lo configuraría} apuntándolo al usuario / grupo de salto / etc. adecuado, configurando horarios, calendarios, etc.

\begin{notice}{note}{Note:}
En este punto, marcando el número público debería de sonar el teléfono de \emph{Alice} consiguiendo, por tanto, el objetivo de este bloque :)
\end{notice}


\chapter{Realizar llamadas externas}
\label{external_outgoing_calls/index:realizar-llamadas-externas}\label{external_outgoing_calls/index::doc}
El objetivo de este bloque será configurar IvozProvider para realizar llamadas externas salientes, partiendo de la configuración realizada hasta este momento.

Para ello, seguiremos los siguientes pasos:


\section{¿A dónde llamo?}
\label{external_outgoing_calls/call_types::doc}\label{external_outgoing_calls/call_types:a-donde-llamo}
En este punto de la configuración, tenemos que configurar IvozProvider para que las llamadas a los destinos externos que vayamos a probar salgan por el Contrato de \emph{peering} que hemos configurado en el bloque anterior.

Para ello, en primer lugar, necesitamos que los números externos recaigan en un \textbf{patrón de destino} dado de alta con anterioridad.


\subsection{Patrones de destino}
\label{external_outgoing_calls/call_types:target-patterns}\label{external_outgoing_calls/call_types:patrones-de-destino}
Cuando un usuario marca un número externo, IvozProvider intenta calificar este número en uno de los patrones de destino definidos en esta sección:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{target_patterns_section}.png}\hspace*{\fill}}

Lo más normal será que nos interese tener un patrón de destino por cada uno de los 254 países definidos en la \href{https://es.wikipedia.org/wiki/ISO\_3166}{ISO 3166}. Por ese motivo, IvozProvider incluye estos países y sus prefijos de forma automática:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{target_patterns_default}.png}\hspace*{\fill}}

Dentro de este listado aparece el prefijo de España, que será el grupo del número que probemos en este bloque:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{target_patterns_spain}.png}\hspace*{\fill}}

\begin{notice}{warning}{Warning:}
Cada operador de marca puede elegir mantener estos patrones o borrarlos y crear los que le interesen. De hecho, aparte de prefijos, también se pueden definir expresiones regulares. e.g. Queremos crear un único patrón que englobe todas las llamadas: \textasciicircum{}{[}0-9{]}+\$.
\end{notice}

\begin{notice}{danger}{Danger:}
Crear patrones de destino en base a expresiones regulares puede provocar que un número encaje en 2 patrones. Usar con responsabilidad.
\end{notice}


\subsection{Grupos de patrones}
\label{external_outgoing_calls/call_types:grupos-de-patrones}
Como veremos en la sección de {\hyperref[external_outgoing_calls/call_routing:outgoing\string-routes]{\sphinxcrossref{\DUrole{std,std-ref}{rutas salientes}}}}, cada patrón de destino se vinculará a un Contrato de Peering concreto.

Por este motivo, puede ser interesante agrupar los patrones en grupos y así poder vincular un grupo entero a un Contrato de Peering.

Para ello se utiliza esta sección:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{target_patterngroups_section}.png}\hspace*{\fill}}

Por defecto aparecen los 254 países agrupados en base a su continente definidos en la \href{https://es.wikipedia.org/wiki/ISO\_3166}{ISO 3166}:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{target_patterngroups_default}.png}\hspace*{\fill}}

\begin{notice}{important}{Important:}
\textbf{En resumen}, cuando un usuario marca un número externo, IvozProvider busca el patrón de destino al que pertenece para saber por dónde tiene que sacar dicha llamada.
\end{notice}

Para conseguir nuestro objetivo de llamar a un número español, no hemos tenido que modificar el contenido de partida de estas dos secciones :)
\phantomsection\label{external_outgoing_calls/call_routing:outgoing-routes}
Ya tenemos nuestra llamada de pruebas categorizada dentro del \textbf{Patrón de destino} `España'. Es más, también tenemos un \textbf{Grupo de patrones de destino} que incluye `España', `Europa'.

Ahora solo nos falta decir a IvozProvider que las llamadas de `España' o de `Europa' salgan por nuestro \textbf{Contrato de peering}.


\section{Rutas salientes}
\label{external_outgoing_calls/call_routing:rutas-salientes}\label{external_outgoing_calls/call_routing::doc}
Para realizar esta vinculación, accedemos a la sección \textbf{Rutas salientes}:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{outgoing_routes_section}.png}\hspace*{\fill}}

Si optamos por enrutar solamente las llamadas de España por nuestro Contrato de \emph{peering}, tendremos que realizar la siguiente configuración:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{outgoing_routes_by_pattern}.png}\hspace*{\fill}}

Por el contrario, si somos más generosos y decidimos permitir todas las llamadas a países europeos, la configuración a aplicar sería la siguiente:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{outgoing_routes_by_patterngroup}.png}\hspace*{\fill}}
\phantomsection\label{external_outgoing_calls/call_routing:routes-metrics}
Existen dos parámetros que merecen explicación:
\begin{description}
\item[{Prioridad\index{Prioridad|textbf}}] \leavevmode\phantomsection\label{external_outgoing_calls/call_routing:term-prioridad}
Si una llamada concreta encaja con rutas de distinta prioridad, la llamada se sacará por la que menor prioridad tenga siempre y cuando esté disponible.

\item[{Métrica\index{Métrica|textbf}}] \leavevmode\phantomsection\label{external_outgoing_calls/call_routing:term-metrica}
Si una llamada concreta encaja con rutas con la misma prioridad, la métrica determina cuántas se sacarán por una ruta y cuántas por otra.

\end{description}

\begin{notice}{note}{Note:}
Estos dos parámetros son clave para conseguir dos funcionalidades muy interesantes: \textbf{load-balancing} y \textbf{failover-routes}.
\end{notice}


\subsection{Balanceo de carga}
\label{external_outgoing_calls/call_routing:balanceo-de-carga}
El balanceo de carga o \emph{load-balancing} nos permite sacar un porcentaje de llamadas por una ruta y otro porcentaje de llamadas por otra ruta, es decir, nos permite repartir las llamadas entre dos o más rutas igualmente válidas.
\paragraph{Ejemplo 1}
\begin{itemize}
\item {} 
Ruta A: prioridad 1, métrica 1

\item {} 
Ruta B: prioridad 1, métrica 1

\end{itemize}

Las llamadas que encajen en ambas rutas se sacaran el 50\% por una ruta y el 50\% por la otra.
\paragraph{Ejemplo 2}
\begin{itemize}
\item {} 
Ruta A: prioridad 1, métrica 1

\item {} 
Ruta B: prioridad 1, métrica 2

\end{itemize}

Las llamadas que encajen en ambas rutas se sacaran el 33\% por la Ruta A y el 66\% por la Ruta B (el doble por B que por A).


\subsection{Conmutación por error}
\label{external_outgoing_calls/call_routing:conmutacion-por-error}
Las rutas en caso de fallo o \emph{failover-routes} nos permite disponer de ruta adicional en caso de que la ruta preferida falle.
\paragraph{Ejemplo}
\begin{itemize}
\item {} 
Ruta A: prioridad 1, métrica 1

\item {} 
Ruta B: prioridad 2, métrica 1

\end{itemize}

Las llamadas que encajen en ambas rutas se intentarán sacar siempre por la Ruta A. En caso de no error (operador caído, etc.), se intentará sacar por la Ruta B.

\begin{notice}{tip}{Tip:}
Tanto el balanceo de carga como las rutas de fallo permiten encadenar/utilizar más de 2 rutas, aunque en los ejemplo se hayan utilizado solo 2.
\end{notice}


\section{Configurar DDI saliente}
\label{external_outgoing_calls/external_ddi:external-ddi}\label{external_outgoing_calls/external_ddi::doc}\label{external_outgoing_calls/external_ddi:configurar-ddi-saliente}
Antes de realizar la llamada externa, estaría muy bien que dicha llamada se presentara con el DDI que ya hemos configurado en entrada, así el llamado podría devolvernos la llamada cómodamente.

Para ello, basta con configurar dicho DDI como \textbf{DDI saliente} de \emph{Alice}, que será la elegida para realizar la primera llamada saliente de nuestro recién instalado IvozProvider:

\noindent\sphinxincludegraphics{{ddi_out}.png}

Esta configuración se realiza desde \textbf{Configuración de empresa} \textgreater{} \textbf{Usuarios}, editando el usuario de \emph{Alice}. Si ese el operador de marca o el operador global el que realiza esta edición, tendrá que haber {\hyperref[internal_calls/brand_portal:emulate\string-company]{\sphinxcrossref{\DUrole{std,std-ref}{emulado la empresa}}}} previamente.

\begin{notice}{warning}{Warning:}
Sin configurar un DDI saliente para el usuario que realiza la llamada, ésta no saldrá al exterior.
\end{notice}

Llegados a este punto y estando deseosos como estamos de hacer nuestra primera llamada, habremos intentando llamar con la configuración actual pero...


\section{Sin plan de precio, no hay llamada}
\label{external_outgoing_calls/noplan_nocall:noplan-nocall}\label{external_outgoing_calls/noplan_nocall:sin-plan-de-precio-no-hay-llamada}\label{external_outgoing_calls/noplan_nocall::doc}
Tal y como advertimos {\hyperref[operation_roles/index:brand\string-responsibilities]{\sphinxcrossref{\DUrole{std,std-ref}{cuando describimos las funciones del operador de marca}}}}, el operador de marca era el \textbf{responsable de realizar la configuración necesaria para que todas las llamadas externas se puedan tarificar}.

\begin{notice}{note}{Note:}
Se entiende por \textbf{tarificar} la \textbf{acción de poner precio} a una llamada que implique coste.
\end{notice}

Para evitar que por un descuido el operador de marca no defina el precio para un tipo de llamada y llamadas que implican coste salgan a precio 0, \textbf{en el momento del establecimiento de una llamada se comprueba que la llamada se va a poder tarificar}.

\begin{notice}{error}{Error:}
Si una llamada no se va a poder tarificar, IvozProvider no permitirá su establecimiento.
\end{notice}


\subsection{Crear un patrón de precio}
\label{external_outgoing_calls/noplan_nocall:crear-un-patron-de-precio}\label{external_outgoing_calls/noplan_nocall:price-pattern}
Del mismo modo que existen los {\hyperref[external_outgoing_calls/call_types:target\string-patterns]{\sphinxcrossref{\DUrole{std,std-ref}{patrones de destino}}}}, existen los \textbf{patrones de precio} y se configuran en esta sección:

\noindent\sphinxincludegraphics{{pricing_pattern_section}.png}

\begin{notice}{important}{Important:}
Para que una llamada se considere tarificable, tiene que \emph{matchear} con algún patrón de precio dado de alta previamente.
\end{notice}

A diferencia de los patrones de destino, que vienen precreados con los 254 países del mundo, los patrones de precio no se crean ya que lo habitual es que un país se divida en muchos patrones de precio (redes GSM de un operador, numeraciones especiales, números fijos, números móviles, etc.).

Creemos el patrón de precio \emph{Spain} para nuestra llamada saliente externa:

\noindent\sphinxincludegraphics{{pricing_pattern_add}.png}


\subsection{Crear un plan de precio}
\label{external_outgoing_calls/noplan_nocall:price-plan}\label{external_outgoing_calls/noplan_nocall:crear-un-plan-de-precio}
Un \textbf{Plan de precio} determina el coste de un tipo de llamada (de un patrón de precio) y se configura en esta sección:

\noindent\sphinxincludegraphics{{pricing_plans_section}.png}

Creamos un \textbf{plan de precio} para nuestro objetivo:

\noindent\sphinxincludegraphics{{pricing_plans_add1}.png}

Y le añadimos el \textbf{patrón de precio} que hemos creado antes:

\noindent\sphinxincludegraphics{{pricing_plans_add_price1}.png}

\noindent\sphinxincludegraphics{{pricing_plans_add_price2}.png}

\begin{notice}{note}{Note:}
Los números decimales se tienen que introducir utilizando el ''.'' como separador decimal (e.g. 0.02)
\end{notice}
\paragraph{Encontrar un plan de precios para un destino concreto}

Para comprobar que hasta este punto la configuración es correcta, podemos \textbf{encontrar un plan de precio} para una llamada concreta pulsando:

\noindent\sphinxincludegraphics{{pricing_plans_find_plan}.png}

Introducimos el número destino en {\hyperref[external_incoming_calls/numeric_transformations:e164]{\sphinxcrossref{\DUrole{std,std-ref}{formato E.164}}}}:

\noindent\sphinxincludegraphics{{pricing_plans_find_plan2}.png}

Y vemos que \emph{matchea} con el \textbf{plan de precio} que acabamos de crear:

\noindent\sphinxincludegraphics{{pricing_plans_find_plan3}.png}


\subsection{Vincular plan de precio a empresa}
\label{external_outgoing_calls/noplan_nocall:pricing-plan-to-company}\label{external_outgoing_calls/noplan_nocall:vincular-plan-de-precio-a-empresa}
Un \textbf{plan de precios} concreto se puede vincular a \emph{n} empresas y corresponde al \emph{Operador de marca} realizar esta vinculación.

Para ello, desde la sección \textbf{Configuración de Marca} \textgreater{} \textbf{Empresas}, seleccionando la empresa \emph{demo}:

\noindent\sphinxincludegraphics{{pricing_plans_relate_company}.png}

La vinculación de \textbf{Planes de precio} y \textbf{Empresas} es efectiva en un período de tiempo concreto, de ahí que haya que seleccionar \emph{Fecha inicio} y \emph{Fecha fin}:

\noindent\sphinxincludegraphics{{pricing_plans_relate_company2}.png}

La \textbf{metrica} de la vinculación permite vincular más de un \emph{plan de precios} a una empresa de forma coincidente en el tiempo, aunque ciertos destinos estén incluidos en más de uno de esos planes de precio.

\begin{notice}{attention}{Attention:}
Una llamada que puede tarificarse en base a más de un plan de precio vinculado a una empresa y activo en un momento dado lo hará en base al plan de precio con menor métrica.
\end{notice}

\begin{notice}{tip}{Tip:}
Esto permite tener un \emph{Plan de precios} general y matizar el coste de algún tipo de llamada en otro \emph{Plan de precio} (móviles gratis, por ejemplo).
\end{notice}
\paragraph{Simular una llamada desde una empresa concreta}

Del mismo modo que al crear un \emph{Plan de precios} hemos comprobado que a nuestra llamada aplicaba dicho plan, podemos simular una llamada concreta en una empresa concreta y saber qué coste se le aplicaría:

\noindent\sphinxincludegraphics{{pricing_plans_simulate_companycall}.png}

Introducimos el número destino en {\hyperref[external_incoming_calls/numeric_transformations:e164]{\sphinxcrossref{\DUrole{std,std-ref}{formato E.164}}}}:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{pricing_plans_simulate_companycall2}.png}\hspace*{\fill}}

Y vemos que efectivamente se le asignaría un precio correcto en base al plan de precio que acabamos de crear y vincular:

\noindent\sphinxincludegraphics{{pricing_plans_simulate_companycall3}.png}

\begin{notice}{note}{Note:}
En este punto, \emph{Alice} debería de ser capaz de realizar llamadas nacionales externas, que se tendrían que cursar y tarificar con normalidad.
\end{notice}


\chapter{Funcionalidades de PBX}
\label{pbx_features/index::doc}\label{pbx_features/index:funcionalidades-de-pbx}
En el bloque anterior hemos conseguido realizar llamadas internas y externas realizando una configuración mínima, partiendo de la configuración que deja el propio instalador y dejando de lado múltiples apartados y funcionalidades.

El objetivo de este bloque será describir cada una de estas secciones con profundidad y ver así las funcionalidades de PBX que IvozProvider ofrece.

Para ello, seguiremos el siguiente índice:


\section{Extensiones}
\label{pbx_features/extensions:extensiones}\label{pbx_features/extensions:extensions}\label{pbx_features/extensions::doc}
La configuración de partida incluía 2 extensiones (101 y 102) que apuntaban directamente a \emph{Alice} y \emph{Bob}, por lo que apenas dijimos nada sobre la sección \textbf{Configuración de empresa} \textgreater{} \textbf{Extensiones}.

\begin{notice}{note}{Note:}
\textbf{Una extensión es}, por definición, \textbf{un número interno con una lógica asignada}.
\end{notice}
\paragraph{Crear una nueva extensión}

La ventana de creación de una nueva extensión es tal que así:

\noindent\sphinxincludegraphics{{extension_add}.png}
\begin{description}
\item[{Número\index{Número|textbf}}] \leavevmode\phantomsection\label{pbx_features/extensions:term-numero}
El número que al ser marcado por un usuario interno activará la lógica que sigue. Tiene que tener una longitud mínima de 2 y estar compuesto únicamente por dígitos.

\item[{Enrutar\index{Enrutar|textbf}}] \leavevmode\phantomsection\label{pbx_features/extensions:term-enrutar}
Este selector nos permite indicar la lógica que seguirá esta numeración cuando sea marcada por un usuario concreto. Al seleccionar un ítem en cuestión, se nos mostrará un selector adicional para seleccionar el grupo de salto, sala de conferencias, etc.

\end{description}

\begin{notice}{note}{Note:}
En el caso de las extensiones que apuntan a usuario, la vinculación con el usuario concreto tendrá que hacerse desde \textbf{Configuración de empresa} \textgreater{} \textbf{Usuarios}.
\end{notice}

\begin{notice}{warning}{Warning:}
Si existe una extensión cuyo número conflicte con un número externo, el número externo quedará enmascarado y resultará, en la práctica, inaccesible para toda la empresa.
\end{notice}


\section{Terminales}
\label{pbx_features/terminals:terminals}\label{pbx_features/terminals::doc}\label{pbx_features/terminals:terminales}
La sección \textbf{Configuración de empresa} \textgreater{} \textbf{Terminales} permite dar de alta credenciales SIP que podrán ser utilizados por diversos dispositivos SIP para realizar y recibir llamadas de IvozProvider.

La mejor forma de entender la sección es crear uno nuevo y ver los campos que tenemos que cumplimentar:

\noindent\sphinxincludegraphics{{terminals_add}.png}
\begin{description}
\item[{Nombre\index{Nombre|textbf}}] \leavevmode\phantomsection\label{pbx_features/terminals:term-nombre}
Usuario que utilizará el terminal para presentarse ante IvozProvider y para realizar la fase de autenticación SIP.

\item[{Contraseña\index{Contraseña|textbf}}] \leavevmode\phantomsection\label{pbx_features/terminals:term-contrasena}
Contraseña que utilizará el terminal para responder a la fase de autenticación SIP. Utilizar el generador automático de contraseñas para cumplir los criterios de seguridad exigidos.

\item[{Codecs rechazados/permitidos\index{Codecs rechazados/permitidos|textbf}}] \leavevmode\phantomsection\label{pbx_features/terminals:term-codecs-rechazados-permitidos}
Indica las capacidades del terminal en lo que a codecs se refiere. Primero se descarta los rechazados y posteriormente incluye los soportados. Se recomienda dejar \emph{alaw} como único soportado.

\item[{Modo de actualización\index{Modo de actualización|textbf}}] \leavevmode\phantomsection\label{pbx_features/terminals:term-modo-de-actualizacion}
Indica si el terminal prefiere utilizar reINVITEs o UPDATEs para actualizar la sesión. La sección de ayuda indica qué terminales suelen requerir qué método. En caso de duda, utilizar \emph{invite}.

\item[{Modelo de terminal\index{Modelo de terminal|textbf}}] \leavevmode\phantomsection\label{pbx_features/terminals:term-modelo-de-terminal}
Indica el tipo de provisión que tendrá que recibir este terminal concreto. En el apartado dedicado a la {\hyperref[provisioning/index:provisioning]{\sphinxcrossref{\DUrole{std,std-ref}{provisión de terminales}}}} se verá que existen unos modelos con provisión automática y se explicará todo en profundidad. En caso de no necesitar provisión, utilizar \emph{Generic}.

\item[{MAC\index{MAC|textbf}}] \leavevmode\phantomsection\label{pbx_features/terminals:term-mac}
Campo necesario para modelos que utilizan el sistema de {\hyperref[provisioning/index:provisioning]{\sphinxcrossref{\DUrole{std,std-ref}{provisión de terminales}}}} de IvozProvider. Recoge la \href{https://es.wikipedia.org/wiki/Direcci\%C3\%B3n\_MAC}{dirección física} del adaptador de red del dispositivo SIP.

\end{description}

\begin{notice}{note}{Note:}
\textbf{En la mayoría} de dispositivos, siempre que no requieran provisión, \textbf{bastará con rellenar el nombre y contraseña}.
\end{notice}

\begin{notice}{hint}{Hint:}
Una vez dado de alta el Terminal, en la mayoría de dispositivos bastará con configurar nombre, contraseña y {\hyperref[internal_calls/brand_portal:domain\string-per\string-company]{\sphinxcrossref{\DUrole{std,std-ref}{dominio SIP de la compañía}}}} para poder llamar.
\end{notice}


\section{Permisos de llamada}
\label{pbx_features/call_permissions:permisos-de-llamada}\label{pbx_features/call_permissions:call-permissions}\label{pbx_features/call_permissions::doc}
Los \textbf{Permisos de llamada} determinan qué usuarios pueden llamar a qué destinos internos.

\begin{notice}{attention}{Attention:}
Las extensiones internas son accesibles por todos los usuarios, \textbf{los permisos de llamada solo aplican a llamadas externas}.
\end{notice}

La configuración de \textbf{permisos de llamada} tiene 2 partes:
\begin{itemize}
\item {} 
Clasificar las llamadas en determinados tipos utilizando \textbf{expresiones regulares} \footnote[*]{\sphinxAtStartFootnote%
\url{https://es.wikipedia.org/wiki/Expresi\%C3\%B3n\_regular}
}:
\begin{itemize}
\item {} 
A nivel de marca: \textbf{Configuración de Marca} \textgreater{} \textbf{Patrones de permiso genéricos}.

\item {} 
A nivel de empresa: \textbf{Configuración de Empresa} \textgreater{} \textbf{Patrones de permisos de llamada}.

\end{itemize}

\item {} 
Definir políticas para los patrones deseados: \textbf{Configuración de Empresa} \textgreater{} \textbf{Permisos llamada}

\end{itemize}


\subsection{Patrones de permiso}
\label{pbx_features/call_permissions:patrones-de-permiso}
La clasificación de llamadas se realiza en las secciones indicadas a nivel de marca o a nivel de empresa.

\begin{notice}{note}{Note:}
Cuando un operador de marca crea una empresa, todos los \textbf{Patrones de permiso genéricos} definidos en ese momento a nivel de \textbf{Configuración de Marca} se copian a \textbf{Configuración de Empresa} \textgreater{} \textbf{Patrones de permisos de llamada}. De esta forma, el operador de marca puede definir los más habituales y evitar este trabajo a los administradores de empresa.
\end{notice}

La creación de nuevos patrones es muy simple:

\noindent\sphinxincludegraphics{{permissions_patterns}.png}

Este nuevo patrón de permisos engloba las llamadas que comiencen por 6 o 7 y sigan con 8 dígitos del 0 al 9. Es decir, engloba todas las numeraciones móviles nacionales.

Otros patrones de permisos que pueden resultar interesantes son:
\begin{itemize}
\item {} \begin{description}
\item[{Fijos nacionales (incluyendo numeraciones especiales: 902, etc.): \textasciicircum{}{[}89{]}{[}0-9{]}\{8\}\$}] \leavevmode\begin{itemize}
\item {} 
Un 8 o un 9 seguido de 8 dígitos.

\end{itemize}

\end{description}

\item {} \begin{description}
\item[{Fijos nacionales (excluyendo numeraciones especiales: 902, etc.): \textasciicircum{}{[}89{]}{[}1-9{]}{[}0-9{]}\{7\}\$}] \leavevmode\begin{itemize}
\item {} 
Un 8 o un 9, seguido de 1 dígito del 1 al 9, seguido de 7 dígitos.

\end{itemize}

\end{description}

\item {} \begin{description}
\item[{Llamadas internacionales: \textasciicircum{}00{[}0-9{]}+\$}] \leavevmode\begin{itemize}
\item {} 
00 (código internacional) seguido de 1 o más dígitos.

\end{itemize}

\end{description}

\item {} \begin{description}
\item[{Llamadas a Reino Unido: \textasciicircum{}0044{[}0-9{]}+\$}] \leavevmode\begin{itemize}
\item {} 
00 (código internacional), 44 (código de UK), seguido de 1 o más dígitos.

\end{itemize}

\end{description}

\end{itemize}
\paragraph{Formato de los números externos}

Las expresiones regulares de los patrones de permiso tienen que utilizar el formato que utilice un usuario del mismo país que la compañía a la hora de llamar.

Es decir, un usuario (español, porque tal y como veremos los usuarios tienen también un código de país) de una empresa de española llamará a números móviles, por ejemplo, así: 676 676 676.

\begin{notice}{danger}{Danger:}
No se utiliza código de país ni formato E.164, \textbf{se escriben las expresiones regulares tal y como llamaría un usuario con el mismo código de país que la empresa en cuestión}.
\end{notice}


\subsection{Permisos de llamada}
\label{pbx_features/call_permissions:id2}
La definición de un \textbf{Permiso de llamada} utiliza una lógica más fácil de describir con un ejemplo.

Imaginemos que tenemos los siguientes \textbf{patrones de permisos}:

\noindent\sphinxincludegraphics{{permissions_patterns_list}.png}

Podríamos definir un \textbf{Permiso de llamada} como el que sigue:

\noindent\sphinxincludegraphics{{permissions_add}.png}

\begin{notice}{note}{Note:}
La acción por defecto describe lo que hay que hacer con la llamada una vez que se han evaluado todas las reglas (permitir/rechazar).
\end{notice}

Editamos el \textbf{permiso de llamada} que acabamos de crear para añadir las reglas necesarias:

\noindent\sphinxincludegraphics{{permissions_add2}.png}

La \textbf{métrica} determina el orden de evaluación de las reglas y la acción lo que se hará con la llamada en caso de \emph{matchear} (permitir/rechazar).

\noindent\sphinxincludegraphics{{permissions_add3}.png}

Una vez hecho lo propio para el otro \textbf{patrón de permisos}, nuestro \textbf{permiso de llamadas} quedará como sigue:

\noindent\sphinxincludegraphics{{permissions_add4}.png}

Ya solo faltaría añadírselo a un usuario concreto en la sección \textbf{Configuración de empresa} \textgreater{} \textbf{Usuarios}:

\noindent\sphinxincludegraphics{{permissions_add5}.png}

Desde este momento, Alice solo podría llamar a extensiones internas (siempre están permitidas) y a móviles y fijos nacionales.


\section{Usuarios}
\label{pbx_features/users:usuarios}\label{pbx_features/users::doc}\label{pbx_features/users:users}
El proceso de instalación nos creó a \emph{Alice} y a \emph{Bob}, y esto nos permitió ahorrar mucho tiempo a la hora de conseguir que se llamarán entre ellos.

También nos permitió pasar un poco de puntillas por la sección de \textbf{Usuarios}, que ahora pasamos a definir en profundidad.

Para ello, nada mejor que editar el usuario \emph{Alice} y describir cada campo del mismo, bloque a bloque:


\subsection{Datos personales}
\label{pbx_features/users:datos-personales}
\noindent\sphinxincludegraphics{{users_edit_personal_data}.png}
\begin{description}
\item[{Nombre\index{Nombre|textbf}}] \leavevmode\phantomsection\label{pbx_features/users:term-nombre}
Se utilizará para referenciar al usuario en múltiples ámbitos, incluyendo el nombre que se presenta en llamadas internas.

\item[{Apellidos\index{Apellidos|textbf}}] \leavevmode\phantomsection\label{pbx_features/users:term-apellidos}
Irá junto con el Nombre en casi todos los casos.

\item[{Email\index{Email|textbf}}] \leavevmode\phantomsection\label{pbx_features/users:term-email}
Dirección de correo electrónico del usuario al que se enviarán los mensajes de voz del buzón.

\end{description}


\subsection{Credenciales portal de usuario}
\label{pbx_features/users:credenciales-portal-de-usuario}
\noindent\sphinxincludegraphics{{users_edit_login}.png}
\begin{description}
\item[{Nombre de usuario\index{Nombre de usuario|textbf}}] \leavevmode\phantomsection\label{pbx_features/users:term-nombre-de-usuario}
Nombre de usuario para acceder al {\hyperref[userportal/index:userportal]{\sphinxcrossref{\DUrole{std,std-ref}{portal de usuario}}}}.

\item[{Contraseña\index{Contraseña|textbf}}] \leavevmode\phantomsection\label{pbx_features/users:term-contrasena}
Contraseña para acceder al {\hyperref[userportal/index:userportal]{\sphinxcrossref{\DUrole{std,std-ref}{portal de usuario}}}}.

\item[{Activo\index{Activo|textbf}}] \leavevmode\phantomsection\label{pbx_features/users:term-activo}
Da posibilidad al administrador de la plataforma de desactivar el acceso al {\hyperref[userportal/index:userportal]{\sphinxcrossref{\DUrole{std,std-ref}{portal de usuario}}}}.

\end{description}


\subsection{Configuración básica}
\label{pbx_features/users:configuracion-basica}
\noindent\sphinxincludegraphics{{users_edit_basic_config}.png}
\begin{description}
\item[{Terminal\index{Terminal|textbf}}] \leavevmode\phantomsection\label{pbx_features/users:term-terminal}
Los terminales dados de alta en {\hyperref[pbx_features/terminals:terminals]{\sphinxcrossref{\DUrole{std,std-ref}{Terminales}}}} se listan aquí para realizar la vinculación usuario-terminal.

\item[{Extensión\index{Extensión|textbf}}] \leavevmode\phantomsection\label{pbx_features/users:term-extension}
Tal y como se explicaba en {\hyperref[pbx_features/extensions:extensions]{\sphinxcrossref{\DUrole{std,std-ref}{Extensiones}}}}, fija la extensión del usuario para llamadas internas.

\item[{DDI de salida\index{DDI de salida|textbf}}] \leavevmode\phantomsection\label{pbx_features/users:term-ddi-de-salida}
Adelantado en {\hyperref[external_outgoing_calls/external_ddi:external\string-ddi]{\sphinxcrossref{\DUrole{std,std-ref}{Configurar DDI saliente}}}}, determina el número que presenta el usuario en llamadas externas salientes.

\item[{Permiso de llamada\index{Permiso de llamada|textbf}}] \leavevmode\phantomsection\label{pbx_features/users:term-permiso-de-llamada}
Asignación de un grupo de permisos explicado en profundidad {\hyperref[pbx_features/call_permissions:call\string-permissions]{\sphinxcrossref{\DUrole{std,std-ref}{aquí}}}}.

\item[{No molestar\index{No molestar|textbf}}] \leavevmode\phantomsection\label{pbx_features/users:term-no-molestar}
Impide que nadie pueda llamar a este usuario, sin impedirle a él llamar a donde desee.

\item[{Llamada en espera\index{Llamada en espera|textbf}}] \leavevmode\phantomsection\label{pbx_features/users:term-llamada-en-espera}
Determina si el sistema tendrá que llamar al usuario cuando éste ya esté en conversación.

\end{description}


\subsection{Buzón de voz}
\label{pbx_features/users:buzon-de-voz}
\noindent\sphinxincludegraphics{{users_edit_vm}.png}
\begin{description}
\item[{Buzón de voz\index{Buzón de voz|textbf}}] \leavevmode\phantomsection\label{pbx_features/users:term-buzon-de-voz}
Activa o desactiva \textbf{la existencia} del buzón de voz del usuario. Aparte de existir, como veremos {\hyperref[pbx_features/users:fwd\string-to\string-vm]{\sphinxcrossref{\DUrole{std,std-ref}{más adelante}}}}, habrá que desviar las llamadas que queramos al buzón.

\item[{Notificar por email\index{Notificar por email|textbf}}] \leavevmode\phantomsection\label{pbx_features/users:term-notificar-por-email}
Mandar a la dirección del usuario un correo notificando del mensaje de voz.

\item[{Adjuntar audio del mensaje\index{Adjuntar audio del mensaje|textbf}}] \leavevmode\phantomsection\label{pbx_features/users:term-adjuntar-audio-del-mensaje}
Adjuntar o no en dicho mail el audio del mensaje

\end{description}


\subsection{Jefe-Asistente}
\label{pbx_features/users:jefe-asistente}
\noindent\sphinxincludegraphics{{users_edit_boss}.png}

La funcionalidad jefe-asistente impide que un usuario sea molestado por nadie que no sea:
\begin{itemize}
\item {} 
Su asistente.

\item {} 
Las excepciones que él defina.

\end{itemize}

Toda llamada con destino a \emph{un jefe} será desviada al asistente.
\begin{description}
\item[{Jefe\index{Jefe|textbf}}] \leavevmode\phantomsection\label{pbx_features/users:term-jefe}
Indica que el usuario en cuestión es jefe o no.

\item[{Asistente\index{Asistente|textbf}}] \leavevmode\phantomsection\label{pbx_features/users:term-asistente}
Si el usuario es jefe, indica quién es su asistente.

\item[{Whitelist jefe/asistente\index{Whitelist jefe/asistente|textbf}}] \leavevmode\phantomsection\label{pbx_features/users:term-whitelist-jefe-asistente}
Permite indicar utilizando expresiones regulares las excepciones deseadas.

\end{description}

Con la configuración de la imagen, toda llamada a \emph{Alice} acabará en \emph{Bob}, salvo las que haga el propio \emph{Bob} y el número de teléfono 945 945 945.


\subsection{Pertenencia a grupos}
\label{pbx_features/users:pertenencia-a-grupos}
\noindent\sphinxincludegraphics{{users_edit_groups}.png}

Tal y como se verá en las secciones {\hyperref[pbx_features/huntgroups:huntgroups]{\sphinxcrossref{\DUrole{std,std-ref}{Grupos de salto}}}} y {\hyperref[pbx_features/call_captures:capture\string-groups]{\sphinxcrossref{\DUrole{std,std-ref}{Capturas de llamada}}}}, un usuario puede pertenecer a uno o a varios grupos de captura y grupos de salto.

Aparte de poder configurar dicha pertenencia desde las propias secciones {\hyperref[pbx_features/huntgroups:huntgroups]{\sphinxcrossref{\DUrole{std,std-ref}{Grupos de salto}}}} y {\hyperref[pbx_features/call_captures:capture\string-groups]{\sphinxcrossref{\DUrole{std,std-ref}{Capturas de llamada}}}}, se puede añadir al usuario que estamos editando a los grupos de captura y grupos de salto deseados que ya existan.

En el caso de la pertenencia a \textbf{grupos de salto}, también se puede configurar desde el listado general:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{users_huntgroups}.png}\hspace*{\fill}}


\subsection{Desvíos de llamada}
\label{pbx_features/users:desvios-de-llamada}
Los desvíos de las llamadas de un usuario concreto se configura pulsando el siguiente botón:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{users_call_fwd}.png}\hspace*{\fill}}
\phantomsection\label{pbx_features/users:fwd-to-vm}
Para desviar las llamadas externas que no se contesten en 15 segundos al buzón de voz que acabamos de configurar, por ejemplo, habría que configurar un desvío tal que:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{users_call_fwd2}.png}\hspace*{\fill}}

Estos son los campos y los posibles valores:
\begin{description}
\item[{Tipo de llamada\index{Tipo de llamada|textbf}}] \leavevmode\phantomsection\label{pbx_features/users:term-tipo-de-llamada}
Limita el desvío a cierto tipo de llamadas, a elegir entre externa, interna o ambas

\item[{Tipo de desvío\index{Tipo de desvío|textbf}}] \leavevmode\phantomsection\label{pbx_features/users:term-tipo-de-desvio}\begin{description}
\item[{Indica cuándo aplica el desvío:}] \leavevmode\begin{itemize}
\item {} 
Incondicional: siempre

\item {} 
Perdida: cuando no se conteste al de X segundos

\item {} 
Ocupado: cuando el usuario esté ocupado (hablando o con el \emph{No molestar} activo)

\item {} 
No registrado: cuando el usuario tenga su terminal sin conectar con IvozProvider

\end{itemize}

\end{description}

\item[{Tipo de destino\index{Tipo de destino|textbf}}] \leavevmode\phantomsection\label{pbx_features/users:term-tipo-de-destino}\begin{description}
\item[{Indica a dónde se enviará la llamada cuando el desvío aplique:}] \leavevmode\begin{itemize}
\item {} 
Buzón de voz

\item {} 
Número (externo)

\item {} 
Extensión (interna)

\end{itemize}

\end{description}

\end{description}

\begin{notice}{hint}{Hint:}
Si queremos que desviar a un grupo de salto, por ejemplo, bastaría con crear una extensión que apunte al grupo de salto deseado y seleccionar \emph{Extensión} en el \textbf{Tipo de destino}.
\end{notice}


\section{Música en espera}
\label{pbx_features/music_on_hold::doc}\label{pbx_features/music_on_hold:musica-en-espera}\label{pbx_features/music_on_hold:musiconhold}
La música en espera suena cuando un usuario retiene la llamada y su interlocutor queda a la espera de seguir la conversación.

IvozProvider permite definir la música que sonará en estos momentos en 2 niveles distintos:
\begin{itemize}
\item {} 
A nivel de operador de marca: \textbf{Configuración de Marca} \textgreater{} \textbf{Músicas en espera genéricas}

\item {} 
A nivel de administrador de empresa: \textbf{Configuración de Empresa} \textgreater{} \textbf{Música en espera}

\end{itemize}

Si una empresa define su música en espera, sonará. Si, por el contrario, no define ninguna, sonará la que haya definido el operador de su marca.

\begin{notice}{note}{Note:}
Se pueden definir más de una música en espera y el sistema elegirá de forma aleatoria la música en espera para cada llamada.
\end{notice}
\paragraph{Añadir una nueva música en espera}

\noindent\sphinxincludegraphics{{moh_add}.png}

Una vez \emph{encodeada} el campo \textbf{Status} muestra que está \emph{ready} y se utilizará en las próximas llamadas:

\noindent\sphinxincludegraphics{{moh_add2}.png}

\begin{notice}{tip}{Tip:}
IvozProvider reconoce archivos de audio en los formatos más comunes y los \emph{encodea} a los formatos óptimos para la plataforma.
\end{notice}

Después de \emph{encodear}, podemos descargar el archivo original y el convertido sin más que editar el ítem:

\noindent\sphinxincludegraphics{{moh_add3}.png}


\section{Locuciones}
\label{pbx_features/sounds::doc}\label{pbx_features/sounds:locuciones}
Las locuciones de la plataforma se crean y se suben de forma idéntica a cómo lo hacen las {\hyperref[pbx_features/music_on_hold:musiconhold]{\sphinxcrossref{\DUrole{std,std-ref}{músicas en espera}}}}.

La sección que permite al administrador de empresa subir las locuciones que utilizará en diversos puntos de la configuración (IVR, etc.) es \textbf{Configuración de Empresa} \textgreater{} \textbf{Locuciones}.

\noindent\sphinxincludegraphics{{sounds}.png}

\begin{notice}{hint}{Hint:}
La única diferencia entre una \textbf{locución} y una \textbf{música en espera} es su uso: la primera sonará cuando el administrador de empresa lo indique (fuera de horario, IVRs, etc.) y la segunda, en cambio, cuando la llamada sea retenida por un usuario.
\end{notice}


\section{Filtros de entrada externo}
\label{pbx_features/external_filters:filtros-de-entrada-externo}\label{pbx_features/external_filters:external-filters}\label{pbx_features/external_filters::doc}
Una de las configuraciones más habituales que todo administrador de empresa querrá realizar en un momento dado es poner filtros de horario y de calendario a sus {\hyperref[pbx_features/external_ddis:external\string-ddis]{\sphinxcrossref{\DUrole{std,std-ref}{DDIs externos}}}}.

Para ello, el primer paso es crear un horario.
\paragraph{Crear un horario}

La sección \textbf{Configuración de Empresa} \textgreater{} \textbf{Horarios} permite definir los tramos horarios en los que un {\hyperref[pbx_features/external_ddis:external\string-ddis]{\sphinxcrossref{\DUrole{std,std-ref}{DDI externo}}}} está dentro de horario.

La interfaz que se le presenta al administrador de empresa cuando añade un horario es la siguiente:

\noindent\sphinxincludegraphics{{timetables_add}.png}

Con la configuración anterior, hemos definido el tramo horario de mañana de una empresa de Lunes a Jueves.

Sigamos con el ejemplo y definamos el tramo horario de tarde de Lunes a Jueves:

\noindent\sphinxincludegraphics{{timetables_add2}.png}

Y el horario reducido de los viernes:

\noindent\sphinxincludegraphics{{timetables_add3}.png}

Ya tenemos los siguientes tramos horarios que, combinados, describen un horario de oficina tradicional:

\noindent\sphinxincludegraphics{{timetables_add4}.png}

\begin{notice}{warning}{Warning:}
Los horarios definen, una vez sumados, los tramos horarios activos: toda hora que no caiga dentro de uno de los tramos agrupados será considerada como llamada fuera de horario.
\end{notice}
\paragraph{Crear un calendario}

Los calendarios definen, una vez sumados, los días que se tienen que considerar festivos.

Imaginemos que creamos 3 calendarios tal que:

\noindent\sphinxincludegraphics{{calendars_list}.png}

La creación de calendarios solo requiere dar un nombre al mismo, una vez creado hay que añadir días festivos a dicho calendario pulsando el botón de la derecha del lápiz:

\noindent\sphinxincludegraphics{{calendars_add_day}.png}

Desde este momento, es calendario tiene marcado el día 1 de Enero de 2016 como día festivo con locución de festivo especial llamada ``Feliz año''.

\begin{notice}{warning}{Warning:}
Los calendarios tienen una lógica contraria a los horarios: si un día concreto no está definido como festivo en uno de los calendarios, será considerado como día laborable.
\end{notice}

\begin{notice}{hint}{Hint:}
Si un día es festivo en un calendario y no hay locución de festivo especial, se reproducirá la locución de festivo del filtro de entrada externo (ver más abajo).
\end{notice}
\paragraph{Crear un filtro de entrada externo}

Una vez que tenemos unos horaris y unos calendarios creados, llega el momento de agruparlos en lo que en IvozProvider se conoce por \textbf{Filtro de entrada externos}.

El interfaz que se le presenta al administrador de empresa es el siguiente:

\noindent\sphinxincludegraphics{{external_call_filter}.png}
\begin{description}
\item[{Nombre\index{Nombre|textbf}}] \leavevmode\phantomsection\label{pbx_features/external_filters:term-nombre}
Nombre con el que se referenciará este filtro.

\item[{Locución de bienvenida\index{Locución de bienvenida|textbf}}] \leavevmode\phantomsection\label{pbx_features/external_filters:term-locucion-de-bienvenida}
Esta locución se reproduce siempre que la llamada no se va a rechazar por festivo o fuera horario (es decir, en una hora normal de un día normal).

\item[{Locución de festivo\index{Locución de festivo|textbf}}] \leavevmode\phantomsection\label{pbx_features/external_filters:term-locucion-de-festivo}
Esta locución se reproducirá cuando el día de hoy esté marcado como festivo en uno de los calendarios y no se haya definido una locución de festivo especial en dicho calendario para ese día.

\item[{Tipo de desvío festivo\index{Tipo de desvío festivo|textbf}}] \leavevmode\phantomsection\label{pbx_features/external_filters:term-tipo-de-desvio-festivo}
Si una llamada entra un día festivo, aparte de la locución de festivo (si la hay), se puede realizar un desvío a un buzón de voz, a un número externo o a una extensión interna. En el ejemplo, la llamada se desviará los días festivos al móvil 676 676 676.

\item[{Locución fuera horario\index{Locución fuera horario|textbf}}] \leavevmode\phantomsection\label{pbx_features/external_filters:term-locucion-fuera-horario}
Esta locución se reproducirá cuando, siendo un día no festivo, la hora actual no esté dentro de ningunos de los horarios vinculados.

\item[{Tipo de desvío fuera horario\index{Tipo de desvío fuera horario|textbf}}] \leavevmode\phantomsection\label{pbx_features/external_filters:term-tipo-de-desvio-fuera-horario}
Lo mismo que en festivo, pero para el caso de fuera horario. En la imagen, no se ejecutaría ningún desvío.

\item[{Calendarios\index{Calendarios|textbf}}] \leavevmode\phantomsection\label{pbx_features/external_filters:term-calendarios}
Permite seleccionar múltiples calendarios, de forma que el calendario del filtro es la suma de todos ellos.

\item[{Horarios\index{Horarios|textbf}}] \leavevmode\phantomsection\label{pbx_features/external_filters:term-horarios}
Permite seleccionar múltiples horarios, de forma que el horario del filtro es la suma de todos ellos.

\end{description}

\begin{notice}{attention}{Attention:}
El día festivo tiene prevalencia sobre el fuera horario. Primero se evalúan los calendarios, luego los horarios.
\end{notice}

En la siguiente sección veremos como este filtro se asigna a los {\hyperref[pbx_features/external_ddis:external\string-ddis]{\sphinxcrossref{\DUrole{std,std-ref}{DDIs externos}}}} que queramos, definiendo así el comportamiento de los mismos fuera de horario y en días festivos, así como dentro de horario en el caso de \emph{setear} locución de bienvenida en el filtro.


\section{Grupos de salto}
\label{pbx_features/huntgroups:grupos-de-salto}\label{pbx_features/huntgroups::doc}\label{pbx_features/huntgroups:huntgroups}
Los grupos de salto nos permiten definir lógicas de \emph{ringado} más allá de la básica \textbf{llamada a usuario}.

Existen de varios tipos:
\begin{description}
\item[{A todos\index{A todos|textbf}}] \leavevmode\phantomsection\label{pbx_features/huntgroups:term-a-todos}
La llamada suena en varios terminales a la vez durante el tiempo definido.

\item[{Secuencialmente (una vez)\index{Secuencialmente (una vez)|textbf}}] \leavevmode\phantomsection\label{pbx_features/huntgroups:term-secuencialmente-una-vez}
Suenan los usuarios definidos, en el orden definido y durante el tiempo definido a cada uno de ellos. Al acabar la secuencia, la llamada se cuelga.

\item[{Secuencialmente (infito)\index{Secuencialmente (infito)|textbf}}] \leavevmode\phantomsection\label{pbx_features/huntgroups:term-secuencialmente-infito}
Suenan los usuarios definidos, en el orden definido y durante el tiempo definido. Al acabar la secuencia, se vuelve a iniciar la secuencia.

\item[{Aleatoriamente\index{Aleatoriamente|textbf}}] \leavevmode\phantomsection\label{pbx_features/huntgroups:term-aleatoriamente}
Reparte las llamadas entre los usuarios elegidos de forma aleatoria, sonando cada uno de ellos el tiempo acordado. Una vez que suenan todos, la llamada se cuelga.

\end{description}
\paragraph{Ejemplo 1: Grupo de salto \emph{ringall}}

Creemos por ejemplo un grupo de salto que llame a la par a nuestros 2 usuarios durante 30 segundos:

\noindent\sphinxincludegraphics{{huntgroup_add}.png}

Pulsando el icono de las personas podemos añadir a Alice y Bob a nuestro grupo de salto:

\noindent\sphinxincludegraphics{{huntgroup_add2}.png}
\paragraph{Ejemplo 2: Grupo de salto secuencial}

Editemos ahora este grupo de salto para que llame 10 segundos a Alice y después 15 segundos a Bob, reiniciando la secuencia si ninguno de los 2 contesta:

\noindent\sphinxincludegraphics{{huntgroup_add3}.png}

En este caso tenemos que indicar una \textbf{prioridad} (los usuarios suenan de menos a mayor prioridad) y un tiempo de \emph{ringing}:

\noindent\sphinxincludegraphics{{huntgroup_add4}.png}

\begin{notice}{hint}{Hint:}
Para que ciertas lógicas (desvíos, etc.) alcancen un \textbf{Grupo de salto}, basta con crear una extensión apuntando a dicho grupo de salto y utilizar esta extensión como destino de la lógica.
\end{notice}

Creemos la extensión 200 que apunte a este grupo de salto:

\noindent\sphinxincludegraphics{{huntgroup_extension}.png}


\section{Interactive Voice Response (IVR)}
\label{pbx_features/ivrs::doc}\label{pbx_features/ivrs:interactive-voice-response-ivr}
Un IVR es la forma habitual de realizar \textbf{menús telefónicos} en los que \textbf{el llamante puede decidir el destino de su llamada sin más que pulsar dígitos} en base a las locuciones que se le van reproduciendo.


\subsection{IVRs genéricos}
\label{pbx_features/ivrs:generic-ivrs}\label{pbx_features/ivrs:ivrs-genericos}
En los IVR genéricos el llamante marca directamente una extensión interna que conoce (o que se le indica en la locución de bienvenida) y el sistema le pone en contacto con dicha extensión de forma automática:

\noindent\sphinxincludegraphics{{ivr_generic}.png}

Describamos cada uno de los parámetros de un IVR genérico:
\begin{description}
\item[{Nombre\index{Nombre|textbf}}] \leavevmode\phantomsection\label{pbx_features/ivrs:term-nombre}
Forma de referenciar el IVR

\item[{Timeout\index{Timeout|textbf}}] \leavevmode\phantomsection\label{pbx_features/ivrs:term-timeout}
Tiempo adicional al de la locución de bienvenida que el sistema espera a que el interlocutor marque los dígitos.

\item[{Locución de bienvenida\index{Locución de bienvenida|textbf}}] \leavevmode\phantomsection\label{pbx_features/ivrs:term-locucion-de-bienvenida}
Locución que se le presenta al llamante invitándole a marcar la extensión con la que quiera hablar.

\item[{Locución de éxito\index{Locución de éxito|textbf}}] \leavevmode\phantomsection\label{pbx_features/ivrs:term-locucion-de-exito}
En caso de que la extensión marcada sea correcta, se reproducirá esta locución (típicamente dirá algo así como ``Contantando...'').

\item[{Expresión regular lista negra\index{Expresión regular lista negra|textbf}}] \leavevmode\phantomsection\label{pbx_features/ivrs:term-expresion-regular-lista-negra}
Si queremos que alguna extensión interna no sea accesible desde el IVR, basta con añadirla aquí utilizando expresiones regulares. En el ejemplo, las extensiones 105 y 106 no serían accesibles desde el IVR y marcarlas provocaría que se activase la \textbf{Configuración de Error}.

\item[{Configuración No contesta\index{Configuración No contesta|textbf}}] \leavevmode\phantomsection\label{pbx_features/ivrs:term-configuracion-no-contesta}
En caso de que la extensión destino no conteste en el tiempo indicado, se reproduce la locución indicada y se desvía al número externo, extensión interna o buzón seleccionado.

\item[{Configuración Error\index{Configuración Error|textbf}}] \leavevmode\phantomsection\label{pbx_features/ivrs:term-configuracion-error}
Si lo que ha marcado el llamante no es válido (o no ha marcado nada), se reproduce la locución indicada y se desvía la llamada al número externo, extensión interna o buzón seleccionado.

\end{description}


\subsection{IVRs a medida}
\label{pbx_features/ivrs:ivrs-a-medida}\label{pbx_features/ivrs:custom-ivrs}
A diferencia de los IVRs genéricos en donde el llamante solo puede marcar extensiones internas, los IVRs a medida permiten marcar dígitos que luego se pueden convertir a lo que el administrador de empresa desee.

\begin{notice}{hint}{Hint:}
El caso más típico es el IVR que dice algo así como ``Marque 1 si quiere hablar con administración, marque 2 si quiere hablar con informática...''
\end{notice}

Los campos que se presentan son prácticamente idénticos al IVR genérico:

\noindent\sphinxincludegraphics{{ivr_custom}.png}

La única diferencia es que no existe el campo \textbf{Expresión regular lista negra}, que carece de sentido en este tipo de IVRs.

Pulsando el botón de la siguiente imagen se pueden definir las equivalencias deseadas:

\noindent\sphinxincludegraphics{{ivr_custom2}.png}

En este caso se puede marcar 1, 2 y 3 (todo lo demás será considerado inválido y activará la \textbf{Configuración de Error}):

\noindent\sphinxincludegraphics{{ivr_custom3}.png}
\begin{itemize}
\item {} 
1: Llamada a la extensión interna 200, creada {\hyperref[pbx_features/huntgroups:huntgroups]{\sphinxcrossref{\DUrole{std,std-ref}{en la sección anterior}}}} y que apunta al grupo de salto \emph{Recepción}.

\item {} 
2: Llama a la extensión interna 101.

\item {} 
3: Desvía la llamada al número externo 676 676 676.

\end{itemize}

\begin{notice}{note}{Note:}
Cada una de las opciones del IVR a medida permite la selección de una locución que pisa a la \textbf{locución de éxito} si está definida. De esta forma aparte de tener una locución de éxito genérica con ``Contactando'' podríamos tener otra que dijera ``Contactando con Administración, espere por favor''.
\end{notice}


\section{Salas de audioconferencias}
\label{pbx_features/conference_rooms:salas-de-audioconferencias}\label{pbx_features/conference_rooms::doc}\label{pbx_features/conference_rooms:conference-rooms}
IvozProvider provee la funcionalidad de salas de audiconferencias que se pueden configurar en la sección \textbf{Configuración de empresa} \textgreater{} \textbf{Salas de conferencias}.
\paragraph{Crear una sala de audioconferencias}

La siguiente imagen ilustra el proceso de creación de una sala de audioconferencias:

\noindent\sphinxincludegraphics{{conference_room}.png}
\begin{description}
\item[{Nombre\index{Nombre|textbf}}] \leavevmode\phantomsection\label{pbx_features/conference_rooms:term-nombre}
Nombre por el que se referenciará la sala en otras secciones

\item[{Límite de participantes\index{Límite de participantes|textbf}}] \leavevmode\phantomsection\label{pbx_features/conference_rooms:term-limite-de-participantes}
Apartir del número especificado, no se admitirán más miembros.

\item[{Protegido con contraseña / Código PIN\index{Protegido con contraseña / Código PIN|textbf}}] \leavevmode\phantomsection\label{pbx_features/conference_rooms:term-protegido-con-contrasena-codigo-pin}
Se puede forzar al sistema a pedir un PIN para poder entrar. En caso de activar, se puede introducir un PIN numérico.

\end{description}

\begin{notice}{note}{Note:}
Para desactivar el límite de participantes, configurar su valor a 0.
\end{notice}
\paragraph{Asociar una extensión o un DDI externo}

De poco sirve una sala de conferencias si no podemos meter a los participantes a la misma.

Para poder meter participantes, el primer paso sería asociar una extensión interna a la sala, para poder desvíar a la misma, transferir, etc.:

\noindent\sphinxincludegraphics{{conference_room_ext}.png}

En la siguiente sección veremos como también se puede apuntar un {\hyperref[pbx_features/external_ddis:external\string-ddis]{\sphinxcrossref{\DUrole{std,std-ref}{DDI externo}}}} a una sala de conferencias, para meter en la sala a gente externa a la empresa.

\begin{notice}{hint}{Hint:}
Existen otras formas de meter un participante externo a una sala de audioconferencias sin dedicar un DDI externo: que alguien de dentro transfiera la llamada a la extensión de la sala, acceder por medio de un IVR, etc.
\end{notice}


\section{DDIs externos}
\label{pbx_features/external_ddis:ddis-externos}\label{pbx_features/external_ddis:external-ddis}\label{pbx_features/external_ddis::doc}
En la sección preliminar {\hyperref[external_incoming_calls/configure_ddi:settingup\string-ddi]{\sphinxcrossref{\DUrole{std,std-ref}{Dar de alta un DDI externo}}}} se describió con todo detalle la configuración necesaria para configurar un DDI externo directo a un usuario.

Después de explicar las secciones anteriores, podemos llevar esta configuración un poco más allá:


\subsection{Filtro de entrada}
\label{pbx_features/external_ddis:filtro-de-entrada}
Podemos seleccionar el \textbf{Filtro de entrada externo} configurado en {\hyperref[pbx_features/external_filters:external\string-filters]{\sphinxcrossref{\DUrole{std,std-ref}{la sección anterior}}}}.

\noindent\sphinxincludegraphics{{ddi_edit}.png}


\subsection{Tratamientos}
\label{pbx_features/external_ddis:routing-logics}\label{pbx_features/external_ddis:tratamientos}
Vemos que tenemos más opciones aparte de enviar la llamada, una vez superado los filtros de horario y calendario (y previa locución de bienvenida), directamente a un usuario:
\begin{itemize}
\item {} 
{\hyperref[pbx_features/huntgroups:huntgroups]{\sphinxcrossref{\DUrole{std,std-ref}{Grupos de salto}}}}

\end{itemize}

\noindent\sphinxincludegraphics{{ddi_edit2}.png}
\begin{itemize}
\item {} 
{\hyperref[pbx_features/ivrs:generic\string-ivrs]{\sphinxcrossref{\DUrole{std,std-ref}{IVR Genérico}}}}

\end{itemize}

\noindent\sphinxincludegraphics{{ddi_edit3}.png}
\begin{itemize}
\item {} 
{\hyperref[pbx_features/ivrs:custom\string-ivrs]{\sphinxcrossref{\DUrole{std,std-ref}{IVR a medida}}}}

\end{itemize}

\noindent\sphinxincludegraphics{{ddi_edit4}.png}
\begin{itemize}
\item {} 
{\hyperref[pbx_features/conference_rooms:conference\string-rooms]{\sphinxcrossref{\DUrole{std,std-ref}{Salas de audioconferencias}}}}

\end{itemize}

\noindent\sphinxincludegraphics{{ddi_edit5}.png}

\begin{notice}{hint}{Hint:}
También podemos apuntar el DDI a un {\hyperref[faxing/index:faxing\string-system]{\sphinxcrossref{\DUrole{std,std-ref}{fax virtual}}}}, pero esto se verá en el siguiente bloque.
\end{notice}


\section{Capturas de llamada}
\label{pbx_features/call_captures:capture-groups}\label{pbx_features/call_captures::doc}\label{pbx_features/call_captures:capturas-de-llamada}
Se entiende por captura de llamada \textbf{la acción de un usuario que escucha} (o se entera de otro modo, vía panel de supervisión, etc.) \textbf{que una extensión está sonando y, desde su terminal, roba dicha llamada}.

IvozProvider soporta dos tipos de captura de llamadas:
\begin{description}
\item[{Captura de llamadas directa\index{Captura de llamadas directa|textbf}}] \leavevmode\phantomsection\label{pbx_features/call_captures:term-captura-de-llamadas-directa}
En las capturas de llamadas directas el usuario indica un código que incluye la extensión del teléfono cuya llamada quiere \emph{robar}. Si el código fuera *95, por ejemplo, marcaría *95101 para capturar una llamada que esté sonando en la extensión 101.

\item[{Captura de llamadas indirecta\index{Captura de llamadas indirecta|textbf}}] \leavevmode\phantomsection\label{pbx_features/call_captures:term-captura-de-llamadas-indirecta}
En las capturas de llamadas indirectas, en cambio, el usuario indica un código y el sistema busca qué teléfono está sonando dentro de sus grupos de captura.

\end{description}


\subsection{Grupos de captura de llamada}
\label{pbx_features/call_captures:grupos-de-captura-de-llamada}
Para poder realizar \textbf{capturas de llamada indirectas}, el usuario que captura tiene que pertener al mismo grupo de captura que el usuario al que pretende capturar.

La sección \textbf{Grupos de captura de llamada} nos permite crear estos grupos y decir qué usuarios pertenecen a ellos:

\noindent\sphinxincludegraphics{{capture_groups}.png}

Como vimos en la sección de {\hyperref[pbx_features/users:users]{\sphinxcrossref{\DUrole{std,std-ref}{Usuarios}}}}, también se puede editar un usuario para editar los grupos de captura a los que pertenece.

\begin{notice}{note}{Note:}
Un usuario puede pertenecer a más de un grupo de captura, el sistema tendrá en cuenta todos sus grupos.
\end{notice}

Desde el momento en el que un usuario está en un grupo de captura, puede empezar a intentar capturar de forma indirecta pero para ello necesita saber el código de captura.


\subsection{Código de captura de llamada}
\label{pbx_features/call_captures:codigo-de-captura-de-llamada}
IvozProvider permite definir los códigos de captura a 2 niveles:
\begin{itemize}
\item {} 
A nivel de marca en \textbf{Configuración de Marca} \textgreater{} \textbf{Servicios}.

\item {} 
A nivel de empresa en \textbf{Configuración de Empresa} \textgreater{} \textbf{Servicios}.

\end{itemize}

Esto permite que el administrador de marca pueda definir unos códigos genéricos para todas sus empresas y que, las empresas que deseen utilizar otros códigos, puedan redefinirlos.

{\hyperref[pbx_features/services:services]{\sphinxcrossref{\DUrole{std,std-ref}{La siguiente sección}}}} explica todo lo relativo a servicios, que engloba los códigos de captura y otros servicios adicionales a los que se accede marcando códigos que comienzan por *.


\section{Servicios adicionales}
\label{pbx_features/services:services}\label{pbx_features/services::doc}\label{pbx_features/services:servicios-adicionales}
Existen \textbf{servicios especiales} a los que se accede \textbf{marcando códigos} especiales \textbf{desde un terminal} de usuario \textbf{cuando éste está en reposo}.

\begin{notice}{danger}{Danger:}
Los servicios que se definen en esta sección \textbf{no son accesibles en medio de una conversación}. Se activan \textbf{llamando} a los códigos que se mencionarán, no marcándolos en medio de una conversación.
\end{notice}


\subsection{Listado de códigos a nivel global}
\label{pbx_features/services:listado-de-codigos-a-nivel-global}
En el momento de realizar esta documentación, existen los siguientes \textbf{servicios especiales} visibles en la sección \textbf{Gestión general} \textgreater{} \textbf{Servicios}:

\noindent\sphinxincludegraphics{{services_god}.png}
\begin{description}
\item[{Captura Directa\index{Captura Directa|textbf}}] \leavevmode\phantomsection\label{pbx_features/services:term-captura-directa}
Es el servicio que permite capturar metiendo el código que se asigne seguido de la extensión del teléfono a capturar.

\item[{Captura de Grupo\index{Captura de Grupo|textbf}}] \leavevmode\phantomsection\label{pbx_features/services:term-captura-de-grupo}
Es el servicio que permite capturar el teléfono que esté sonando dentro de tu(s) grupo(s) de captura.

\item[{Consultar el buzón de voz\index{Consultar el buzón de voz|textbf}}] \leavevmode\phantomsection\label{pbx_features/services:term-consultar-el-buzon-de-voz}
Este servicio permite acceder a un menú de voz que te presenta los mensajes de voz nuevos, viejos, etc. Es una alternativa a la recepción de mensajes de voz vía correo electrónico.

\end{description}

A medida que la solución vaya evolucionando y surjan servicios nuevos, aparecerán en este listado para que el operador global sepa de su existencia y lo comunique a sus operadores de marca.

\begin{notice}{attention}{Attention:}
Este listado determina los servicios disponibles y los códigos por defecto de las \textbf{nuevas marcas}.
\end{notice}

\begin{notice}{hint}{Hint:}
Cambiar un código solo afecta a las marcas que se creen tras el cambio.
\end{notice}


\subsection{Definición de servicios y códigos a nivel de marca}
\label{pbx_features/services:definicion-de-servicios-y-codigos-a-nivel-de-marca}
La sección \textbf{Configuración de Marca ** \textgreater{} **Servicios} permite al operador de marca:
\begin{itemize}
\item {} 
Redefinir el código de acceso por defecto a dichos servicios para las empresas que a su vez no lo redefinan.

\item {} 
Borrar servicios que no quieran que puedan utilizar sus empresas.

\end{itemize}

Por defecto este listado aparece con todas los servicios y los códigos configurados a nivel Global:

\noindent\sphinxincludegraphics{{services_brand_list}.png}

\begin{notice}{attention}{Attention:}
Este listado determina los servicios disponibles y los códigos por defecto de las \textbf{nuevas empresas}.
\end{notice}

\begin{notice}{hint}{Hint:}
Cambiar un código solo afecta a las empresas que se creen tras el cambio. Borrar un servicio hace que no esté disponible para ninguna empresa de la marca.
\end{notice}


\subsection{Definición de códigos a nivel de empresa}
\label{pbx_features/services:definicion-de-codigos-a-nivel-de-empresa}
Cada empresa puede \emph{pisar} los valores por defecto asignados por su \emph{operador de marca} accediendo a \textbf{Configuración de Empresa} \textgreater{} \textbf{Servicios} y cambiando el código asignado.
\paragraph{Empresa que quiere capturar con ** en lugar de con *95:}

\noindent\sphinxincludegraphics{{services_company_edit}.png}

\begin{notice}{hint}{Hint:}
Los servicios que el \emph{administrador de empresa} borre no podrán ser utilizados por sus usuarios.
\end{notice}


\section{Grabación de llamadas}
\label{pbx_features/call_recording:grabacion-de-llamadas}\label{pbx_features/call_recording::doc}\label{pbx_features/call_recording:call-recordings}
IvozProvider permite grabar las llamadas que se cursan en 2 modalidades distintas:
\begin{itemize}
\item {} 
\textbf{Grabación automática} para llamadas desde/hacia cierto {\hyperref[pbx_features/external_ddis:external\string-ddis]{\sphinxcrossref{\DUrole{std,std-ref}{DDI externo}}}}.

\item {} 
\textbf{Grabación bajo demanda} solicitada por un usuario en medio de una conversación.

\end{itemize}


\subsection{Grabación automática por DDI}
\label{pbx_features/call_recording:grabacion-automatica-por-ddi}
En el caso de grabaciones automáticas por DDI, \textbf{se graba toda la conversación}: desde el principio hasta el final.

Se distinguen 2 casos:
\begin{itemize}
\item {} 
\textbf{Llamadas entrantes a un DDI}: la grabación seguirá mientras la parte externa de la llamada permanezca en la conversación.

\item {} 
\textbf{Llamadas salientes utilizando un DDI} como {\hyperref[pbx_features/external_ddis:external\string-ddis]{\sphinxcrossref{\DUrole{std,std-ref}{DDI saliente}}}}: mientras el interlocutor externo permanezca en la conversación, la grabación sigue.

\end{itemize}

\begin{notice}{attention}{Attention:}
El hecho de que \textbf{mientras el interlocutor permanezca en la llamada la grabación continúe}, hace que no importe cuántes veces se transfiera la llamada de un usuario a otro, la grabación contendrá toda la conversación (desde el punto de vista del participante externo).
\end{notice}
\paragraph{Grabar todas las llamadas de un DDI}

Basta con editar el DDI en cuestión y habilitar las grabaciones:

\noindent\sphinxincludegraphics{{recordings_ddi}.png}

Existen 4 opciones:
\begin{itemize}
\item {} 
Desactivar la grabación

\item {} 
Activarla para llamadas entrantes a dicho DDI

\item {} 
Activarla para llamadas salientes que presente dicho DDI

\item {} 
Activarla para ambas

\end{itemize}


\subsection{Grabación bajo demanda}
\label{pbx_features/call_recording:grabacion-bajo-demanda}
La grabación bajo demanda u \emph{on-demand} la tiene que activar el \emph{operador de marca} para las empresas que la necesiten, sin más que editar su empresa y configurar el código deseado:

\noindent\sphinxincludegraphics{{recordings_ondemand}.png}

\begin{notice}{warning}{Warning:}
A diferencia de los {\hyperref[pbx_features/services:services]{\sphinxcrossref{\DUrole{std,std-ref}{Servicios}}}} comentado en la sección anterior, la funcionalidad de grabación bajo demanda se activa en mitad de una conversación.
\end{notice}


\subsubsection{Activación por medio de tecla \emph{Record}}
\label{pbx_features/call_recording:activacion-por-medio-de-tecla-record}
Los terminales \emph{Yealink} soportan el envío de mensajes \href{https://tools.ietf.org/html/rfc6086}{SIP INFO} con una cabecera \emph{Record} (ver \href{http://www.yealink.com/Upload/document/UsingCallRecordingFeatureonYealinkPhones/UsingCallRecordingFeatureonYealinkSIPT2XPphonesRev\_610-20561729764.pdf}{referencia}). No es un estándar, pero al ser \emph{Yealink} uno de los modelos soportados, IvozProvider incluye soporte para la activación de grabación bajo demanda de esta forma.

\begin{notice}{important}{Important:}
El código seleccionado no influye en este caso, pero \textbf{la empresa sí que tiene que tener las grabaciones bajo demanda activadas}.
\end{notice}

La activación de las grabaciones es muy simple en este caso, basta con pulsar la tecla y el sistema inicia la grabación.


\subsubsection{Activación por medio de transferencia ciega frustrada}
\label{pbx_features/call_recording:activacion-por-medio-de-transferencia-ciega-frustrada}
Existe otra forma de acceder a esta funcionalidad para los terminales que no tengan soporte para el método anterior.

\begin{notice}{danger}{Danger:}
Este método de acceder a la funcionalidad es una forma imaginativa de hacerla accesible para terminales sin soporte nativo de tecla \emph{Record} (que es el método recomendado). En función del terminal en cuestión y de la configuración del mismo, resultará más o menos cómodo utilizar la funcionalidad (tecla rápida de transferencia ciega, no retener al interlocutor, etc.).
\end{notice}

Los pasos a seguir en este método alternativo e imaginativo son los siguientes:
\begin{itemize}
\item {} 
No se activa marcando el código en medio de la conversación.

\item {} 
Se activa iniciando una transferencia ciega al código configurado.

\item {} 
El sistema rechazará la transferencia e iniciará la grabación.

\item {} 
El usuario podrá volver a la conversación que tenía (si es que su terminal no ha vuelto solo) y seguir hablando.

\end{itemize}
\paragraph{¿Por qué esta forma tan \emph{peculiar} de activar la grabación y no por medio de tonos normales?}

El motivo de activar la grabación por medio de una transferencia ciega frustrada se debe a la {\hyperref[architecture/index:architecture]{\sphinxcrossref{\DUrole{std,std-ref}{{[}P{]} Platform general architecture}}}} y, más concretamente, al {\hyperref[architecture/index:audioflow]{\sphinxcrossref{\DUrole{std,std-ref}{flujo de audio RTP}}}}.

Lo habitual suele ser activar servicios por medio de pulsaciones en medio de la llamada (lo que se conoce por \href{https://es.wikipedia.org/wiki/Marcaci\%C3\%B3n\_por\_tonos}{tonos DTMF}). Estos tonos suelen viajar por el mismo camino del audio (siguiendo el \href{https://tools.ietf.org/html/rfc4733}{RFC 4733} o como sonido audible).

IvozProvider utiliza la transmisión de estos tonos siguiendo el \href{https://tools.ietf.org/html/rfc4733}{RFC 4733} y, por tanto, dichos paquetes de audio pasan por los \emph{media-relays}, que se limitan a reenviar el audio sin analizar su contenido. Al no analizar su contenido, no pueden detectar las pulsaciones y activar lógicas.

\begin{notice}{note}{Note:}
Esta decisión de diseño es la que permite escalar la solución y ser capaz de gestionar cientos de miles de llamadas concurrentes.
\end{notice}

Al realizar una transferencia ciega, en cambio, se produce señalización SIP dentro de un diálogo (en concreto, un \href{https://tools.ietf.org/html/rfc3515}{REFER}) y sí que es posible activar lógicas de este estilo, ya que la señalización sigue \sphinxtitleref{otro camino \textless{}signallingflow\textgreater{}} que incluye a los elementos con lógica (servidores de aplicación y \emph{proxies}).

\begin{notice}{warning}{Warning:}
La grabación bajo demanda graba la llamada desde que se activa hasta que el usuario que la activó desaparece de la misma.
\end{notice}

\begin{notice}{important}{Important:}
No existe la funcionalidad de parar la grabación, independientemente del método elegido para activarla.
\end{notice}


\subsection{Listado de grabaciones}
\label{pbx_features/call_recording:listado-de-grabaciones}
El \emph{administrador de empresa} puede acceder a las grabaciones realizadas por medio de la sección \textbf{Configuración de Empresa} \textgreater{} \textbf{Grabaciones}:

\noindent\sphinxincludegraphics{{recordings_list}.png}

Haciendo clic en una de ellas, podría escucharla desde la \emph{web} o descargársela en formato MP3:

\noindent\sphinxincludegraphics{{recordings_list2}.png}

En el caso de una grabación bajo demanda, se indica qué usuario la inició:

\noindent\sphinxincludegraphics{{recordings_list3}.png}


\chapter{Tarificación y facturación}
\label{billing_and_invoices/index::doc}\label{billing_and_invoices/index:tarificacion-y-facturacion}
En este bloque se tratará un tema de primordial importancia para los administradores de marca:
\begin{itemize}
\item {} 
Crear planes de precio para poner precio a las llamadas de los usuarios.

\item {} 
Crear facturas que recojan el detalle y el consumo de sus empresas.

\end{itemize}

Pare ello, abordaremos las siguientes cuestiones:


\section{Histórico de llamadas}
\label{billing_and_invoices/call_registry:historico-de-llamadas}\label{billing_and_invoices/call_registry::doc}\label{billing_and_invoices/call_registry:call-registry}
Los históricos de llamadas muestran todas las llamadas de la plataforma y se muestran a 3 niveles:
\begin{itemize}
\item {} 
\textbf{Gestión general} \textgreater{} \textbf{Histórico de llamadas}

\item {} 
\textbf{Configuración de Marca} \textgreater{} \textbf{Histórico de llamadas}

\item {} 
\textbf{Configuración de Empresa} \textgreater{} \textbf{Histórico de llamadas}

\end{itemize}

En cada uno de los niveles se muestran las llamadas filtradas convenientemente.
\paragraph{A nivel global (god)}

Muestra todas las llamadas de la plataforma, indicando la marca y la empresa de cada una de ellas:

\noindent\sphinxincludegraphics{{call_registry_god}.png}
\paragraph{A nivel de marca}

Muestra todas las llamadas de la marca emulada, indicando la empresa de cada una de ellas:

\noindent\sphinxincludegraphics{{call_registry_brand}.png}
\paragraph{A nivel de empresa}

Muestra todas las llamadas de la empresa emulada:

\noindent\sphinxincludegraphics{{call_registry_company}.png}

\begin{notice}{note}{Note:}
El exportador a \href{https://es.wikipedia.org/wiki/CSV}{CSV} permite exportar el listado para su posterior almacenamiento o procesado.
\end{notice}

\begin{notice}{hint}{Hint:}
Si se accede a una llamada concreta, se muestra información adicional sobre la misma. Esta información adicional depende del nivel (\emph{god}, marca o empresa) y provee información sobre desvíos, transferencias, etc.
\end{notice}


\section{Llamadas facturables}
\label{billing_and_invoices/billable_calls:llamadas-facturables}\label{billing_and_invoices/billable_calls::doc}\label{billing_and_invoices/billable_calls:billable-calls}
Los listados de llamadas de las secciones \textbf{Llamadas facturables} muestran solo las \textbf{llamadas que implican coste}.

\begin{notice}{important}{Important:}
La gran diferencia respecto a las llamadas del {\hyperref[billing_and_invoices/call_registry:call\string-registry]{\sphinxcrossref{\DUrole{std,std-ref}{Histórico de llamadas}}}} es que todas las que aparecen aquí implican coste (no aparecen, por tanto, llamadas internas, etc.)
\end{notice}

Se muestra el coste asociado a las llamadas (una vez calculado) y, dado que las empresas son notificadas de sus llamadas por medio de facturas emitidas por el \emph{operador de marca}, solo se existe a dos niveles:
\begin{itemize}
\item {} 
A nivel global (\emph{god}).

\item {} 
A nivel de marca.

\end{itemize}

Estos listados muestran la siguiente información:
\begin{description}
\item[{Fecha\index{Fecha|textbf}}] \leavevmode\phantomsection\label{billing_and_invoices/billable_calls:term-fecha}
Fecha y hora del establecimiento de la llamada.

\item[{Marca\index{Marca|textbf}}] \leavevmode\phantomsection\label{billing_and_invoices/billable_calls:term-marca}
Solo visible a nivel \emph{god}, indica la marca de la empresa en cuestión.

\item[{Compañía\index{Compañía|textbf}}] \leavevmode\phantomsection\label{billing_and_invoices/billable_calls:term-compania}
Empresa responsable de la llamada.

\item[{Destino\index{Destino|textbf}}] \leavevmode\phantomsection\label{billing_and_invoices/billable_calls:term-destino}
Número externo al que se ha llamado.

\item[{Patrón de destino\index{Patrón de destino|textbf}}] \leavevmode\phantomsection\label{billing_and_invoices/billable_calls:term-patron-de-destino}
Indica el {\hyperref[external_outgoing_calls/noplan_nocall:price\string-pattern]{\sphinxcrossref{\DUrole{std,std-ref}{patrón de precio}}}} en base al cual se ha puesto precio a la llamada.

\item[{Duración\index{Duración|textbf}}] \leavevmode\phantomsection\label{billing_and_invoices/billable_calls:term-duracion}
Indica cuánto ha durado la llamada.

\item[{Tarificado (sí/no)\index{Tarificado (sí/no)|textbf}}] \leavevmode\phantomsection\label{billing_and_invoices/billable_calls:term-tarificado-si-no}
Indica si el proceso que pone precio a las llamadas ha calculado el precio de esta llamada concreta.

\item[{Precio\index{Precio|textbf}}] \leavevmode\phantomsection\label{billing_and_invoices/billable_calls:term-precio}
Coste calculado para la llamada.

\item[{Plan de precio\index{Plan de precio|textbf}}] \leavevmode\phantomsection\label{billing_and_invoices/billable_calls:term-plan-de-precio}
{\hyperref[external_outgoing_calls/noplan_nocall:price\string-plan]{\sphinxcrossref{\DUrole{std,std-ref}{Plan de precio}}}} en base al cual se ha puesto precio a la llamada.

\item[{Contrato de peering\index{Contrato de peering|textbf}}] \leavevmode\phantomsection\label{billing_and_invoices/billable_calls:term-contrato-de-peering}
Indica por qué {\hyperref[external_incoming_calls/peering_contracts:peering\string-contracts]{\sphinxcrossref{\DUrole{std,std-ref}{Contrato de peering}}}} ha salido la llamada.

\item[{Factura\index{Factura|textbf}}] \leavevmode\phantomsection\label{billing_and_invoices/billable_calls:term-factura}
Indica si la llamada está incluida en alguna {\hyperref[billing_and_invoices/invoices:invoices]{\sphinxcrossref{\DUrole{std,std-ref}{factura}}}}.

\item[{Tipo (entrante/saliente)\index{Tipo (entrante/saliente)|textbf}}] \leavevmode\phantomsection\label{billing_and_invoices/billable_calls:term-tipo-entrante-saliente}
Dado que ciertas llamadas entrantes pueden implicar coste (ver {\hyperref[external_incoming_calls/configure_ddi:bill\string-inbound]{\sphinxcrossref{\DUrole{std,std-ref}{tarificación de llamadas entrantes}}}}), indica si la llamada es entrante o saliente.

\end{description}

\begin{notice}{note}{Note:}
Las llamadas aparecen en este listado en cuanto se cuelgan. Pasados unos minutos, el proceso que pone precios a las llamadas habrá tarificado la llamada (\emph{Tarificado} igual a `Sí') y tendremos disponible el \textbf{Precio} calculado.
\end{notice}


\section{Planes de precio}
\label{billing_and_invoices/pricing_plans:planes-de-precio}\label{billing_and_invoices/pricing_plans::doc}
En la sección {\hyperref[external_outgoing_calls/noplan_nocall:noplan\string-nocall]{\sphinxcrossref{\DUrole{std,std-ref}{Sin plan de precio, no hay llamada}}}} se hacía una introducción bastante completa sobre el proceso manual de creación de un plan de precios y los conceptos más importantes:
\begin{itemize}
\item {} 
\textbf{Un plan de precios agrupa un listado de patrones de precio (prefijos de llamada) con sus detalles de precio}:
\begin{itemize}
\item {} 
Precio por minuto

\item {} 
Establecimiento de llamada

\item {} 
Facturación por segundos / minutos /etc.

\end{itemize}

\item {} 
Un plan de precios se asocia a una empresa concreta, indicando el período de validez de dicho plan.

\item {} 
Una empresa podía tener varios planes de precios en un momento concreto para una llamada concreta.

\item {} 
En este último caso, el coste de la llamada se calcularía utilizando el plan de precio de menor métrica.

\end{itemize}


\subsection{Creación manual}
\label{billing_and_invoices/pricing_plans:creacion-manual}
La {\hyperref[external_outgoing_calls/noplan_nocall:price\string-plan]{\sphinxcrossref{\DUrole{std,std-ref}{creación manual de un plan de precio}}}} implicaba la creación previa de un {\hyperref[external_outgoing_calls/noplan_nocall:price\string-pattern]{\sphinxcrossref{\DUrole{std,std-ref}{patrón de precio}}}}.

En ese momento, es posible que el futuro administrador de marca se haya dado cuenta de la titánica tarea que implicaría crear miles de patrones de precio (254 países por las distintas redes móviles, fijos, numeraciones especiales, etc.) para luego poder agruparlos en un plan de precios.

Es por ello que el proceso de creación de planes y patrones de precio se realiza partiendo de un \href{https://es.wikipedia.org/wiki/CSV}{CSV}.


\subsection{Importación vía CSV}
\label{billing_and_invoices/pricing_plans:importacion-via-csv}
El primer paso es crear un plan de precios vacío sobre el que importar nuestros precios (sección \textbf{Configuración de marca} \textgreater{} \textbf{Planes de precio}):

\noindent\sphinxincludegraphics{{pricing_plans_add}.png}

Accedemos al listado (vacío) del plan de precio que acabamos de crear:

\noindent\sphinxincludegraphics{{pricing_plans_add_price}.png}

El botón clave para este proceso de importación masiva es el siguiente:

\noindent\sphinxincludegraphics{{pricing_plan_csv}.png}

Una vez elegido el archivo a importar, se nos presenta la siguiente ventana:

\noindent\sphinxincludegraphics{{pricing_plan_csv3}.png}

En esta ventana podríamos seleccionar qué contiene cada columna, en caso de no haber creado el \href{https://es.wikipedia.org/wiki/CSV}{CSV} en el formato recomendado. Del mismo modo, se nos ofrece la posibilidad de ignorar la primera línea, en caso de que incluya los nombres de las columnas en lugar de datos.

\begin{notice}{hint}{Hint:}
El proceso de importación se realiza en segundo plano, permitiendo al administrador de marca seguir configurando otros aspectos de la plataforma mientras se completa.
\end{notice}


\subsubsection{Formato CSV}
\label{billing_and_invoices/pricing_plans:formato-csv}
A pesar de que la ventana anterior nos permite importar archivos \href{https://es.wikipedia.org/wiki/CSV}{CSV} en distintos formatos, lo mejor es importar un archivo en el formato adecuado para simplicar este proceso.

El formato del archivo \href{https://es.wikipedia.org/wiki/CSV}{CSV} está explicado en la propia sección de ayuda contextual, que incluye un enlace para poder descargar un archivo de ejemplo:

\noindent\sphinxincludegraphics{{pricing_plan_csv2}.png}

El formato, por lo tanto, tiene que ser:
\begin{itemize}
\item {} 
Nombre del patrón de precio

\item {} 
Descripción del patrón de precio

\item {} 
Prefijo

\item {} 
Precio por minuto

\item {} 
Precio de establecimiento

\item {} 
Período de facturación

\end{itemize}

\begin{notice}{note}{Note:}
Los números decimales tienen que estar entrecomillados con comillas dobles y tienen que usar la coma como separador decimal.
\end{notice}

\begin{notice}{important}{Important:}
El sistema de importación creará los patrones de precio que sean necesarios. Si ya existe un patrón de precios con ese prefijo, no se creará, simplemente se vinculará.
\end{notice}

\begin{notice}{warning}{Warning:}
\textbf{El período de facturación determina cada cuántos segundos se incrementa el precio de la llamada}.
\begin{itemize}
\item {} 
Si se pone a 1, implica una tarificación por segundos y cada segundo implicará un coste que será el \emph{precio por minuto} dividido entre 60.

\item {} 
Para facturación por minutos, habrá que poner 60 en este campo y, cada bloque de 1 minuto se sumará el \emph{precio por minuto} al precio final.

\end{itemize}
\end{notice}

Una vez completada la importación, solo faltaría asociar el nuevo plan de precios a las empresas que queramos, siguiendo {\hyperref[external_outgoing_calls/noplan_nocall:pricing\string-plan\string-to\string-company]{\sphinxcrossref{\DUrole{std,std-ref}{el procedimiento explicado en el bloque anterior}}}}.


\section{Tarificación de llamadas}
\label{billing_and_invoices/bill_a_call::doc}\label{billing_and_invoices/bill_a_call:tarificacion-de-llamadas}
Tarificar una llamada es la \textbf{acción de poner precio} a una llamada que implica coste.


\subsection{Tarificación automática}
\label{billing_and_invoices/bill_a_call:tarificacion-automatica}
Tal y como se ha explicado con anterioridad, el proceso de tarificación es automático:
\begin{itemize}
\item {} 
En el momento en el que una llamada se va a establecer, se verifica que se vaya a poder tarificar.
\begin{itemize}
\item {} 
Si no se va a poder tarificar atendiendo a los planes de precios activos para la empresa, la llamada no se cursará.

\end{itemize}

\item {} 
En el momento en el que una llamada que implique coste se cuelga, aparece en el listado de {\hyperref[billing_and_invoices/billable_calls:billable\string-calls]{\sphinxcrossref{\DUrole{std,std-ref}{Llamadas facturables}}}}.

\item {} 
Pasados unos minutos, el proceso tarificador evaluará las llamadas tarificables sin coste y rellenará los siguientes campos del registro anterior:
\begin{itemize}
\item {} 
Precio

\item {} 
Plan de precio

\item {} 
Patrón de destino (que es en realidad el patrón de precio)

\item {} 
Tarificado a `Sí'

\end{itemize}

\end{itemize}


\subsection{Retarificación manual}
\label{billing_and_invoices/bill_a_call:retarificacion-manual}
Puede ocurrir que una llamada se tarifique de forma incorrecta, por múltiples motivos:
\begin{itemize}
\item {} 
Plan de precio importado con una errata.

\item {} 
Múltiples planes de precios con métricas incorrectas.

\item {} 
Plan de precio adicional sin vincular.

\item {} 
Etc.

\end{itemize}

Para estos casos, el \emph{administrador de marca} puede re-tarificar las llamadas que considere mal tarificadas.

\begin{notice}{important}{Important:}
Retarificar una llamada consiste en volver a calcular el precio de la misma. Lógicamente, la retarificación se calculará en el momento solicitado, teniendo en cuenta las configuración actual de planes de precio (y no las del momento del establecimiento de la llamada).
\end{notice}

Para retarificar, basta con seleccionar las llamadas en \textbf{Configuración de Marca} \textgreater{} \textbf{Llamada facturables} y presionar el botón \textbf{Tarificar llamadas}:

\noindent\sphinxincludegraphics{{retarificate}.png}

\begin{notice}{error}{Error:}
\textbf{No se puede retarificar una llamada que esté incluida en una factura}. Es decir, si la llamada seleccionada tiene el campo \textbf{Factura} con valor, habrá que borrar esta factura previamente. El motivo es estar seguros que no existen facturas con llamadas mal tarificadas: si retarificas una llamada, regeneras la factura que la contiene.
\end{notice}


\section{Generación de facturas}
\label{billing_and_invoices/invoices:invoices}\label{billing_and_invoices/invoices::doc}\label{billing_and_invoices/invoices:generacion-de-facturas}
El objetivo final de todo el proceso de facturación es generar facturas que incluyan las llamadas con coste de una empresa concreta.


\subsection{Plantillas de facturas}
\label{billing_and_invoices/invoices:plantillas-de-facturas}
Antes de generar una factura de ejemplo, es importante entender que las facturas generadas utilizan unas plantillas que permiten su modificación.

\begin{notice}{hint}{Hint:}
De este modo, cada \emph{operador de marca} puede crear plantillas con los datos deseados, la estética deseada, añadir logos y hasta gráficas de consumo.
\end{notice}

Todo ello se realiza utilizando la librería \href{https://github.com/psliwa/PHPPdf}{PHPPdf}.

La ayuda contextual de la sección \textbf{Configuración de Marca} \textgreater{} \textbf{Plantillas de facturas} incluye una explicación resumida del proceso de creación de plantillas. En la \href{https://github.com/psliwa/PHPPdf}{página oficial de PHPPdf} se puede encontrar más información.

Por defecto, IvozProvider incluye las siguientes plantillas de ejemplo (en la ayuda contextual se pueden encontrar enlaces a las mismas):

\noindent\sphinxincludegraphics{{invoices_templates}.png}


\subsection{Costes fijos}
\label{billing_and_invoices/invoices:costes-fijos}
Los costes fijos son un concepto fijo que se pueden añadir a las facturas que utilicen plantillas que tengan en cuenta costes fijos.

Sirva la siguiente imagen de ejemplo (sección \textbf{Costes Fijos}):

\noindent\sphinxincludegraphics{{fixed_costs}.png}

A la hora de generar una factura, como se verá más adelante, se podrá indicar cuáles de estos conceptos se incluyen en la factura (y en qué cantidades).


\subsection{Creacion de una factura}
\label{billing_and_invoices/invoices:creacion-de-una-factura}
La sección \textbf{Facturas} es la que permite al \textbf{operador de marca} generar facturas para emitir a sus empresas.

Añadimos una factura nueva para explicar el proceso:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{invoice_add}.png}\hspace*{\fill}}
\begin{description}
\item[{Número\index{Número|textbf}}] \leavevmode\phantomsection\label{billing_and_invoices/invoices:term-numero}
Será incluído en la factura y representa el número de factura

\item[{Empresa\index{Empresa|textbf}}] \leavevmode\phantomsection\label{billing_and_invoices/invoices:term-empresa}
Empresa para la cual estamos generando la factura

\item[{Fecha inicio/fin\index{Fecha inicio/fin|textbf}}] \leavevmode\phantomsection\label{billing_and_invoices/invoices:term-fecha-inicio-fin}
Tramo temporal cuyas llamadas queremos tener en cuenta

\item[{Impuesto\index{Impuesto|textbf}}] \leavevmode\phantomsection\label{billing_and_invoices/invoices:term-impuesto}
Impuesto a añadir al coste total calculado

\item[{Plantilla\index{Plantilla|textbf}}] \leavevmode\phantomsection\label{billing_and_invoices/invoices:term-plantilla}
Plantilla que queremos utilizar para generar esta factura

\end{description}

Añadamos ahora unos costes fijos a esta factura concreta pulsando:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{invoice_add2}.png}\hspace*{\fill}}

Y añadamos los costes fijos que queramos, así como sus cantidades:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{invoice_add3}.png}\hspace*{\fill}}

En este punto, podemos generar la factura pulsando:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{invoice_add4}.png}\hspace*{\fill}}

Pulsando el siguiente botón podemos ver las llamadas que han sido incluidas en la factura:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{invoice_add5}.png}\hspace*{\fill}}

Y pulsando este botón podemos descargar la factura en formato PDF:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{invoice_add6}.png}\hspace*{\fill}}

\begin{notice}{warning}{Warning:}
La fecha fin tiene que ser una fecha ya pasada. Es decir, no se puede sacar facturas de tramos futuros o del día actual.
\end{notice}

\begin{notice}{error}{Error:}
Todas las llamadas del tramo escogido tienen que estar facturadas para poder emitir la factura.
\end{notice}


\chapter{{[}P{]} Provisión de terminales}
\label{provisioning/index:p-provision-de-terminales}\label{provisioning/index::doc}\label{provisioning/index:provisioning}

\section{Esquema de provisión}
\label{provisioning/index:esquema-de-provision}

\section{Terminales soportados}
\label{provisioning/index:terminales-soportados}

\section{Sistema de plantillas}
\label{provisioning/index:sistema-de-plantillas}

\chapter{Faxing Virtual}
\label{faxing/index::doc}\label{faxing/index:faxing-system}\label{faxing/index:faxing-virtual}
La solución de \emph{faxing} virtual incluida en IvozProvider es muy simple, pero permite:
\begin{itemize}
\item {} 
Enviar faxes partiendo de un PDF.

\item {} 
Recibir faxes vía correo electrónico y visualización web.

\end{itemize}

\begin{notice}{error}{Error:}
IvozProvider utiliza \href{http://www.voip-info.org/wiki/view/T.38}{T.38} para la emisión y recepción de faxes. Es responsabilidad de el administrador de marca disponer de Contratos de Peering con operadores que soporten dicho protocolo, así como configurar las rutas de salida para utilizar dicho operador.
\end{notice}


\section{Creación de un fax virtual}
\label{faxing/index:creacion-de-un-fax-virtual}
Esta es la interfaz que nos encontramos al crear un nuevo fax en la sección \textbf{Configuración de empresa} \textgreater{} \textbf{Faxes Virtuales}:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{fax_add}.png}\hspace*{\fill}}

Los campos son prácticamente auto-explicativos:
\begin{description}
\item[{Nombre\index{Nombre|textbf}}] \leavevmode\phantomsection\label{faxing/index:term-nombre}
Nombre por el que se referenciará el fax en otras secciones

\item[{Email\index{Email|textbf}}] \leavevmode\phantomsection\label{faxing/index:term-email}
Email donde se recibirán los mails (en caso de marcar `Enviar por email' a `Sí')

\item[{DDI de salida\index{DDI de salida|textbf}}] \leavevmode\phantomsection\label{faxing/index:term-ddi-de-salida}
Número que se utilizará como origen en los faxes salientes

\end{description}

Para recibir faxes en dicha numeración, será necesario apuntarla a nuestro nuevo fax, editando el DDI en la sección \textbf{DDIs}:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{fax_ddi}.png}\hspace*{\fill}}

Para enviar faxes por una ruta concreta (que tenemos probada y sabemos que es óptima para la emisión de faxes), se puede definir una ruta exclusiva para faxes:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{fax_routes}.png}\hspace*{\fill}}

Todos los faxes que envíe esa empresa (para todos los faxes que vaya creando), se enviará por esta ruta.

\begin{notice}{note}{Note:}
Si se definieran más rutas de faxing, se utilizarían todas siguiendo las lógicas de \emph{load-balancing} y \emph{failover} descritas en {\hyperref[external_outgoing_calls/call_routing:routes\string-metrics]{\sphinxcrossref{\DUrole{std,std-ref}{secciones anteriores}}}}.
\end{notice}

\begin{notice}{important}{Important:}
Si una empresa no dispone de rutas de faxing, saldrá siguiendo las lógicas de rutado de las llamadas.
\end{notice}


\section{Emitir un fax}
\label{faxing/index:emitir-un-fax}
\noindent{\hspace*{\fill}\sphinxincludegraphics{{fax_send2}.png}\hspace*{\fill}}

\noindent{\hspace*{\fill}\sphinxincludegraphics{{fax_send}.png}\hspace*{\fill}}


\section{Visualización de faxes entrantes}
\label{faxing/index:visualizacion-de-faxes-entrantes}
Los faxes entrantes se pueden recibir vía correo electrónico, pero también pueden ser visualizados y descargados desde el panel web pulsando:

\noindent\sphinxincludegraphics{{fax_list}.png}


\chapter{{[}P{]} Portal de Usuario}
\label{userportal/index:userportal}\label{userportal/index::doc}\label{userportal/index:p-portal-de-usuario}

\section{Credenciales de acceso}
\label{userportal/index:credenciales-de-acceso}

\section{URLs de acceso}
\label{userportal/index:urls-de-acceso}

\section{Funcionalidades}
\label{userportal/index:funcionalidades}

\subsection{Estado del registro SIP}
\label{userportal/index:estado-del-registro-sip}

\subsection{Configuración básica a nivel de usuario}
\label{userportal/index:configuracion-basica-a-nivel-de-usuario}

\chapter{{[}S{]} Elementos de seguridad}
\label{security/index::doc}\label{security/index:s-elementos-de-seguridad}

\section{Firewall con geoIP}
\label{security/index:firewall-con-geoip}

\section{Rangos de IP autorizados por empresa}
\label{security/index:rangos-de-ip-autorizados-por-empresa}
En el proceso de creación de empresas nos saltamos deliberademente un mecanismo de seguridad que \textbf{limita las direcciones IP o rangos de red que pueden utilizar las credenciales de los terminales de una empresa concreta}.

Se puede activar en la sección \textbf{Configuración de Marca} \textgreater{} \textbf{Empresas}:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{authorized_ips2}.png}\hspace*{\fill}}

Todo usuario que quiera conectarse desde una red no incluida no podrá, a pesar de disponer de unas credenciales válidas.

\begin{notice}{error}{Error:}
Una vez activado el filtrado, \textbf{es obligatorio} añadir redes o direcciones válidas o, por el contrario, todas las llamadas se rechazarán:
\end{notice}

\noindent\sphinxincludegraphics{{authorized_ips}.png}

Se pueden añadir direcciones IP y rangos de direcciones, en formato CIDR (IP/mask):

\noindent\sphinxincludegraphics{{authorized_ips3}.png}

\begin{notice}{important}{Important:}
Este mecanismo limita los orígenes de los usuarios de una empresa, no filtra en absoluto los orígenes de los \textbf{Contratos de Peering}.
\end{notice}


\section{Anti-flooding}
\label{security/index:anti-flooding}
IvozProvider incorpora un mecanismo de \emph{anti-flooding} que evita que un emisor sature nuestra plataforma enviando peticiones. Ambos \emph{proxies} (usuarios y salida) incorporan este mecanismo, que \textbf{limita el número de peticiones desde un dirección origen en un tramo concreto de tiempo}.

\begin{notice}{warning}{Warning:}
Cuando un origen llega al límite, el proxy dejará de contestarle durante un tiempo dado. Pasado ese tiempo, volverá a contestarle con normalidad.
\end{notice}

Ciertos orígenes que están automáticamente excluidos de este mecanismo de \emph{anti-flooding}:
\begin{itemize}
\item {} 
Servidores de aplicación de la plataforma.

\item {} 
IPs o rangos autorizados de empresas (ver sección anterior).

\end{itemize}

El operador global puede añadir otras direcciones que queden excluidas de este mecanismo por medio del apartado \textbf{Configuración global} \textgreater{} \textbf{IPs de confianza}:

\noindent\sphinxincludegraphics{{trusted_ips}.png}


\section{Límite de llamadas concurrentes}
\label{security/index:limite-de-llamadas-concurrentes}
Otro mecanismo de seguridad que puede evitar que unas credenciales comprometidas sean utilizadas para establecer cientos de llamadas en poco tiempo, es el mecanismo que \textbf{limita el número de llamadas externas} de cada empresa.

\begin{notice}{note}{Note:}
Este mecanismo tiene en cuenta los canales externos concurrentes, es decir, cuenta llamadas externas entrantes y llamadas externas salientes.
\end{notice}

Se puede configurar editando una empresa y fijando el valor del siguiente campo:

\noindent{\hspace*{\fill}\sphinxincludegraphics{{call_limit}.png}\hspace*{\fill}}

\begin{notice}{tip}{Tip:}
Para desactivar este mecanismo, basta con fijar el valor a 0.
\end{notice}


\chapter{{[}P{]} Mantenimiento de la solución}
\label{maintenance/index:p-mantenimiento-de-la-solucion}\label{maintenance/index::doc}
A continuación se describen las herramientas que incorpora IvozProvider para facilitar el mantenimiento de la solución:


\section{Capturador de tráfico SIP: Homer}
\label{maintenance/sip_captures:capturador-de-trafico-sip-homer}\label{maintenance/sip_captures::doc}

\section{Visor de logs: Graylog}
\label{maintenance/log_viewer:visor-de-logs-graylog}\label{maintenance/log_viewer::doc}

\section{Gráficas de la plataforma: Grafana}
\label{maintenance/platform_graphs::doc}\label{maintenance/platform_graphs:graficas-de-la-plataforma-grafana}


\renewcommand{\indexname}{Index}
\printindex
\end{document}
